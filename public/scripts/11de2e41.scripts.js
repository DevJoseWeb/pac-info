"use strict";angular.module("pacApp",["vegaModule"]).constant("emptyDataChart",{full:{table:[]},empty:{table:[]}}).constant("chartHeight",110).constant("API_URL","http://pac-info.herokuapp.com/ventures/").directive("onSlide",[function(){return{restrict:"A",scope:{next:"&next",prev:"&prev"},link:function(a,b){b.on("slide.bs.carousel",function(b){a.$apply("left"===b.direction?a.next:a.prev)})}}}]).directive("navLink",["$location",function(a){return{restrict:"A",link:function(b,c,d){var e=c.find("a").prop("href").replace("#",""),f=function(){return a.path()},g=angular.isDefined(d.navLinkDefault);b.$watch(f,function(a){c.removeClass("active"),c.addClass(e.search(a)>=0&&"/"!==a?"active":""),c.addClass(g&&"/"===a?"active":"")})}}}]).factory("measureElement",function(){return function(a){return{width:parseInt(a.css("width").replace("px",""),10)}}}),angular.module("pacApp").controller("MainCtrl",["$scope","porRegiaoChart","estagioChart","evolucaoChart","distribuicaoChart","$location",function(a,b,c,d,e,f){var g=[{name:"Norte"},{name:"Nordeste"},{name:"Centro-Oeste"},{name:"Sudeste"},{name:"Sul"}];a.evolucao=d,a.distribuicao=e,a.estagios=c,a.porRegiao=b,a.slides={list:g,current:g[0],next:function(){a.slides.move("right")},prev:function(){a.slides.move("left")},move:function(b){var c=a.slides.list,d=a.slides.current,e=c.indexOf(d)+1,f=(c.indexOf(d)||c.length)-1,g="right"===b?e:f;a.slides.current=c[g%c.length],a.porRegiao.carregarCategoria(a.banner.api,a.slides.current.name)}},a.$on("$locationChangeSuccess",function(){var b=f.path(),c={"/transportes":"Transportes","/comunidade-cidada":"Comunidade Cidadã","/habitacao":"Habitação","/agua-e-luz-para-todos":"Água e Luz para todos","/cidade-melhor":"Cidade Melhor","/energia":"Energia"},d=c[b];a.evolucao.carregarCategoria(b),a.distribuicao.carregarCategoria(b),a.estagios.carregarCategoria(b),a.porRegiao.carregarCategoria(b,a.slides.current.name),a.banner={title:d,api:b}})}]),angular.module("vegaModule",[]).service("vega",function(){return window.vg}).directive("vegaChart",["vega",function(a){return{restrict:"A",scope:{data:"=",spec:"=",opts:"="},link:function(b,c){function d(){var d=b.data.full||b.data,e=b.data.empty||b.data,g=b.opts||{},h=b.spec(c,d,g);f?f.width(h.width).data(d).update({duration:1e3}):a.parse.spec(h,function(a){f=a({el:c[0],data:e}).update(),setTimeout(function(){f.data(d).update({duration:1e3})},500)})}function e(){b.data&&b.data.full&&b.data.full.table&&b.data.full.table.length>0&&d()}var f;b.$watch("ready",e),b.$watch("data",e),angular.element(window).on("resize",e)}}}]),angular.module("pacApp").factory("porRegiaoSpec",["chartHeight","measureElement",function(a,b){return function(c,d,e){var f=b(c).width;return{width:f,height:a,padding:{top:10,left:0,bottom:30,right:0},data:[{name:"table"}],scales:[{name:"x",type:"ordinal",range:"width",domain:{data:"table",field:"data._id"}},{name:"y",range:"height",nice:!0,domain:{data:"table",field:"data.val_2011_2014"},domainMax:e.domainMax||void 0}],axes:[{type:"x",scale:"x",properties:{axis:{strokeWidth:{value:0}},majorTicks:{strokeWidth:{value:0}},labels:{fill:{value:"#FFF"},angle:{value:0},fontSize:{value:12},fontWeight:{value:"200"},align:{value:"center"}}}}],marks:[{type:"rect",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.val_2011_2014",offset:5},y2:{scale:"y",value:0},fill:{value:"#fff"},width:{scale:"x",band:!0,offset:-30}},update:{x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.val_2011_2014",offset:5},y2:{scale:"y",value:0},width:{scale:"x",band:!0,offset:-30}}}},{type:"text",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.val_2011_2014"},fill:{value:"#fff"},text:{field:"data.label"},fontSize:{value:14}},update:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.val_2011_2014"},text:{field:"data.label"}}}}]}}}]).service("porRegiaoChart",["API_URL","$http","porRegiaoSpec","emptyDataChart",function(a,b,c,d){var e=this;this.spec=c,this.data=d,this.clearResponseElement=function(a){var b=angular.copy(a);return b.val_2011_2014="",b},this.transformResponse=function(a){for(var b=[],c=0;c<a.length;c++)b.push(e.clearResponseElement(a[c]));return{full:{table:a},empty:{table:b}}},this.carregarCategoria=function(c,d){var f=a+[c,"by_region",d].join("/");b.get(f).success(function(a){e.data=e.transformResponse(a)})}}]),angular.module("pacApp").factory("evolucaoSpec",["chartHeight","measureElement",function(a,b){return function(c){return{width:b(c).width,height:a,padding:{top:10,left:-10,bottom:30,right:20},data:[{name:"table"}],scales:[{name:"x",type:"ordinal",points:!0,padding:1.5,range:"width",domain:{data:"table",field:"data._id.data_balanco"},reverse:!0},{name:"y",type:"linear",range:"height",nice:!0,zero:!0,domain:{data:"table",field:"data.val_2011_2014"}},{name:"yLabel",type:"ordinal",range:"height",nice:!0,zero:!0,domain:{data:"table",field:"data.label"}}],axes:[{type:"x",scale:"x",grid:!0,properties:{axis:{strokeWidth:{value:0},stroke:{value:"white"}},grid:{stroke:{value:"white"}},majorTicks:{strokeWidth:{value:0}},labels:{fill:{value:"white"},fontSize:{value:14}}}},{type:"y",scale:"y",offset:-40,ticks:3,orient:"right",properties:{axis:{stroke:{value:"white"},strokeWidth:{value:0}},majorTicks:{stroke:{value:"white"}},labels:{fill:{value:"white"},fontSize:{value:14},baseline:{value:"middle"}}}}],marks:[{type:"area",from:{data:"table"},properties:{enter:{interpolate:{value:"monotone"},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.val_2011_2014"},y2:{scale:"y",value:0},fill:{value:"white"},fillOpacity:{value:.3}},update:{interpolate:{value:"monotone"},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.val_2011_2014"},y2:{scale:"y",value:0}}}},{type:"symbol",from:{data:"table"},properties:{enter:{shape:{value:"circle"},size:{value:50},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.val_2011_2014"},y2:{scale:"y",value:0},fill:{value:"white"}},update:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.val_2011_2014"},y2:{scale:"y",value:0}}}},{type:"line",from:{data:"table"},properties:{enter:{interpolate:{value:"monotone"},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.val_2011_2014"},y2:{scale:"y",value:0},stroke:{value:"white"},strokeWidth:{value:2}},update:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.val_2011_2014"},y2:{scale:"y",value:0}}}}]}}}]).service("evolucaoChart",["API_URL","$http","evolucaoSpec","emptyDataChart",function(a,b,c,d){var e=this;this.spec=c,this.data=d,this.transformResponseElement=function(a){a._id.data_balanco=a._id.data_balanco.substring(3)},this.clearResponseElement=function(a){var b=angular.copy(a);return b.val_2011_2014="",b},this.transformResponse=function(a){for(var b=[],c=0;c<a.length;c++)e.transformResponseElement(a[c]),b.push(e.clearResponseElement(a[c]));return{full:{table:a},empty:{table:b}}},this.carregarCategoria=function(c){var d=a+c;b.get(d).success(function(a){e.data=e.transformResponse(a)})}}]),angular.module("pacApp").factory("distribuicaoSpec",["chartHeight","measureElement",function(a,b){return function(c,d,e){var f=b(c).width;return{width:f,height:a,padding:{top:10,left:0,bottom:30,right:0},data:[{name:"table"}],scales:[{name:"x",type:"ordinal",range:"width",domain:{data:"table",field:"data._id"}},{name:"y",range:"height",nice:!0,domain:{data:"table",field:"data.val_2011_2014"},domainMax:e.domainMax||void 0}],axes:[{type:"x",scale:"x",properties:{axis:{strokeWidth:{value:0}},majorTicks:{strokeWidth:{value:0}},labels:{fill:{value:"#FFF"},angle:{value:0},fontSize:{value:12},fontWeight:{value:"200"},align:{value:"center"}}}}],marks:[{key:"data._id",type:"rect",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.val_2011_2014",offset:5},y2:{scale:"y",value:0},fill:{value:"#fff"},width:{scale:"x",band:!0,offset:-30}},update:{x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.val_2011_2014",offset:5},y2:{scale:"y",value:0},width:{scale:"x",band:!0,offset:-30}}}},{type:"text",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.val_2011_2014"},fill:{value:"#fff"},text:{field:"data.label"},fontSize:{value:14}},update:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.val_2011_2014"},text:{field:"data.label"}}}}]}}}]).service("distribuicaoChart",["API_URL","$http","distribuicaoSpec","emptyDataChart",function(a,b,c,d){var e=this;this.spec=c,this.data=d,this.transformResponseElement=function(a){"Equipamentos - Estradas Vicinais"===a._id&&(a._id="Estradas")},this.clearResponseElement=function(a){var b=angular.copy(a);return b.val_2011_2014="",b},this.transformResponse=function(a){for(var b=[],c=0;c<a.length;c++)e.transformResponseElement(a[c]),b.push(e.clearResponseElement(a[c]));return{full:{table:a},empty:{table:b}}},this.carregarCategoria=function(c){var d=a+[c,"by_type"].join("/");b.get(d).success(function(a){e.data=e.transformResponse(a)})}}]),angular.module("pacApp").factory("estagioSpec",["measureElement",function(a){return function(b,c){for(var d=[],e=[],f=0;f<c.table.length;f++)d.push(c.table[f]._id+" :  "+c.table[f].total),e.push(c.table[f].color);return{width:a(b).width,height:400,padding:{top:10,left:10,bottom:10,right:10},data:[{name:"table",transform:[{type:"pie",value:"data.total"}]}],scales:[{name:"r",type:"sqrt",domain:{data:"table",field:"data.total"},range:[130,180]},{name:"size",type:"ordinal",sort:!0,domain:{data:"table",field:"data.total"},range:[100,1e3]},{name:"estagios",type:"ordinal",sort:!0,domain:{data:"table",field:"data.total"},range:d},{name:"color",type:"ordinal",sort:!0,domain:{data:"table",field:"data.total"},range:e}],legends:[{size:"size",fill:"color",orient:"left",properties:{title:{fontSize:{value:16}},symbols:{stroke:{value:"transparent"},shape:{value:"circle"}},labels:{fill:{value:"#656567"},fontSize:{value:16},fontFamily:{value:"Helvetica"},text:{scale:"estagios"}},legend:{padding:{value:10},stroke:{value:"#ccc"},strokeWidth:{value:0},x:{value:0},y:{value:10}}}}],marks:[{type:"arc",from:{data:"table"},properties:{enter:{x:{group:"width",mult:.7},y:{group:"height",mult:.5},startAngle:{field:"startAngle"},endAngle:{field:"endAngle"},innerRadius:{value:80},outerRadius:{scale:"r",field:"data.total"},fill:{field:"data.color"},stroke:{value:"white"},strokeWidth:{value:2}},update:{x:{group:"width",mult:.7},y:{group:"height",mult:.5},startAngle:{field:"startAngle"},endAngle:{field:"endAngle"},innerRadius:{value:80},outerRadius:{scale:"r",field:"data.total"}}}}]}}}]).service("estagioChart",["API_URL","$http","estagioSpec","emptyDataChart",function(a,b,c,d){var e=this,f=["#1DA1CD","#68D286","#EB585C","#A085C6","#FF8FB4","#FDD26D","#FBAD2F"];this.spec=c,this.data=d,this.transformResponseElement=function(a,b){a.color=f[b%f.length]},this.clearResponseElement=function(a){var b=angular.copy(a);return b.total=10,b},this.transformResponse=function(a){for(var b=[],c=0;c<a.length;c++)e.transformResponseElement(a[c],c),b.push(e.clearResponseElement(a[c]));return{full:{table:a},empty:{table:b}}},this.carregarCategoria=function(c){var d=a+[c,"by_status"].join("/");b.get(d).success(function(a){e.data=e.transformResponse(a)})}}]);