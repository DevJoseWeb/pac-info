"use strict";angular.module("pacApp",["vegaModule"]),angular.module("pacApp").controller("MainCtrl",["$scope","porRegiaoChart","estagioChart","evolucaoChart","distribuicaoChart","$location",function(a,b,c,d,e,f){var g=[{name:"Norte"},{name:"Nordeste"},{name:"Centro-Oeste"},{name:"Sudeste"},{name:"Sul"}];a.evolucao=d,a.distribuicao=e,a.estagios=c,a.porRegiao=b,a.slides={list:g,current:g[0],next:function(){a.slides.move("right")},prev:function(){a.slides.move("left")},move:function(b){var c=a.slides.list,d=a.slides.current,e=c.indexOf(d)+1,f=(c.indexOf(d)||c.length)-1,g="right"===b?e:f;a.slides.current=c[g%c.length],a.porRegiao.carregarCategoria(a.banner.api,a.slides.current.name)}},a.$on("$locationChangeSuccess",function(){var b=f.path()||"/transportes",c={"/transportes":"Transportes","/comunidade-cidada":"Comunidade Cidadã","/habitacao":"Habitação","/agua-e-luz-para-todos":"Água e Luz para todos","/cidade-melhor":"Cidade Melhor","/energia":"Energia"},d=c[b];a.evolucao.carregarCategoria(b),a.distribuicao.carregarCategoria(b),a.estagios.carregarCategoria(b),a.porRegiao.carregarCategoria(b,a.slides.current.name),a.banner={title:d,api:b}})}]),angular.module("pacApp").directive("onSlide",[function(){return{restrict:"A",scope:{next:"&next",prev:"&prev"},link:function(a,b){b.on("slide.bs.carousel",function(b){a.$apply("left"===b.direction?a.next:a.prev)})}}}]).directive("navbarPrincipal",[function(){return{restrict:"A",link:function(a,b){var c=b.offset().top,d=c,e=parseInt(b.css("height").replace("px",""),10);angular.element(window).scroll(function(){var a=angular.element(window).scrollTop();a>d?(b.addClass("navbar-fixed-top"),d=c,angular.element("body").css("padding-top",e)):(b.removeClass("navbar-fixed-top"),d=b.offset().top,angular.element("body").css("padding-top",0),c=b.offset().top)})}}}]).directive("navLink",["$location",function(a){return{restrict:"A",link:function(b,c,d){var e=c.find("a").prop("href").replace("#",""),f=function(){return a.path()},g=angular.isDefined(d.navLinkDefault);b.$watch(f,function(a){var b="/"===a||""===a;c.removeClass("active"),c.addClass(e.search(a)>=0&&!b?"active":""),c.addClass(g&&b?"active":"")})}}}]),angular.module("vegaModule",[]).service("vega",function(){return window.vg}).service("screen",[function(){var a=[],b=[];this.trackElement=function(c){var d={onEnter:angular.noop,onLeave:angular.noop,onCenter:angular.noop,didEnter:!1,didCenter:!1,didLeave:!1};return a.push(c),b.push(d),{onEnter:function(a){d.onEnter=a},onLeave:function(a){d.onLeave=a},onCenter:function(a){d.onCenter=a}}},angular.element(window).on("scroll",function(){var c=angular.element(window).scrollTop(),d=window.innerHeight;angular.forEach(a,function(e){var f=angular.element(e).offset().top,g=b[a.indexOf(e)],h=parseInt(angular.element(e).css("height").replace("px",""),10);c+d>f+h?g.didEnter||(g.didEnter=!0,g.onEnter.call()):g.didEnter&&(g.didEnter=!1,g.didCenter=!1,g.onLeave.call())})}),scroll()}]).directive("vegaChart",["vega","screen",function(a,b){return{restrict:"A",scope:{data:"=",spec:"=",opts:"="},link:function(c,d){function e(){var b=c.data.full||c.data,e=c.data.empty||c.data,f=c.opts||{},h=c.spec(d,b,f);g?g.width(h.width).data(b).update({duration:1e3}):a.parse.spec(h,function(a){g=a({el:d[0],data:e}).update(),setTimeout(function(){g.data(b).update({duration:1e3})},500)})}function f(){var a=c.data&&c.data.full&&c.data.full.table&&c.data.full.table.length>0;a&&h&&(e(),angular.element(window).off("scroll",f))}var g,h=!1;c.$watch("ready",f),c.$watch("data",f),angular.element(window).on("resize",f),angular.element(window).on("scroll",f),b.trackElement(d).onEnter(function(){h=!0,f()}),b.trackElement(d).onLeave(function(){h=!1})}}}]),angular.module("pacApp").factory("PacService",["apiUrl","$http",function(a,b){var c=function(a,b){this.transformObjectFunction=a||angular.noop,this.resetObjectFunction=b||angular.noop};return c.prototype.get=function(c){var d=this;return b.get(a(c),{cache:!0,transformResponse:function(a){return d.transformResponse(a)}})},c.prototype.transformResponse=function(a){var b=[],c=angular.fromJson(a),d=this;return angular.forEach(c,function(a){d.transformObjectFunction(a,c.indexOf(a));var b=angular.copy(a);d.resetObjectFunction(b),this.push(b)},b),{empty:{table:b},full:{table:c}}},c}]).factory("apiUrl",function(){return function(a){var b="http://pac-info.herokuapp.com/ventures";return b+a}}).factory("chartSize",function(){return function(a){return{width:parseInt(a.css("width").replace("px",""),10),height:130}}}),angular.module("pacApp").factory("porRegiaoSpec",["chartSize",function(a){return function(b,c,d){return{width:a(b).width,height:a(b).height,padding:{top:20,left:0,bottom:30,right:0},data:[{name:"table"}],scales:[{name:"x",type:"ordinal",points:!0,padding:1,range:"width",domain:{data:"table",field:"data._id"}},{name:"y",range:"height",nice:!0,domain:{data:"table",field:"data.valor_total"},domainMax:d.domainMax||void 0}],axes:[{type:"x",scale:"x",properties:{axis:{strokeWidth:{value:0}},majorTicks:{strokeWidth:{value:0}},labels:{fill:{value:"#FFF"},angle:{value:0},fontSize:{value:12},fontWeight:{value:"200"},align:{value:"center"}}}}],marks:[{type:"rect",from:{data:"table"},properties:{enter:{fill:{value:"#fff"},x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.valor_total"},y2:{scale:"y",value:0},width:{scale:"x",band:!0,offset:-30}},update:{x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.valor_total"},y2:{scale:"y",value:0},width:{scale:"x",band:!0,offset:-30}}}},{type:"text",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.valor_total",offset:-10},fill:{value:"#fff"},text:{field:"data.label"},align:{value:"center"},fontSize:{value:14}},update:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.valor_total",offset:-10},text:{field:"data.label"}}}}]}}}]).service("porRegiaoChart",["PacService","porRegiaoSpec",function(a,b){var c=this;this.spec=b;var d=new a(void 0,function(a){a.valor_total=""});this.carregarCategoria=function(a,b){d.get(a+"/by_region/"+b).success(function(a){c.data=a})}}]),angular.module("pacApp").factory("evolucaoSpec",["chartSize",function(a){return function(b){return{width:a(b).width,height:a(b).height,padding:{top:20,left:0,bottom:30,right:10},data:[{name:"table"}],scales:[{name:"x",type:"ordinal",points:!0,padding:1,range:"width",domain:{data:"table",field:"data._id.data_balanco"},reverse:!0},{name:"y",type:"linear",range:"height",nice:!0,zero:!0,domain:{data:"table",field:"data.valor_total"}},{name:"width",type:"ordinal",range:"width",points:!0,domain:{data:"table",field:"index"}}],axes:[{type:"x",scale:"x",properties:{axis:{strokeWidth:{value:0},stroke:{value:"white"}},grid:{stroke:{value:"white"}},majorTicks:{strokeWidth:{value:0}},labels:{fill:{value:"white"},fontSize:{value:14}}}}],marks:[{type:"text",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total"},baseline:{value:"bottom"},fill:{value:"#fff"},text:{field:""},font:{value:"Helvetica Neue"},fontSize:{value:14},align:{value:"center"}},update:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total"},text:{field:"data.label"}}}},{type:"rect",from:{data:"table"},properties:{enter:{fill:{value:"#fff"},fillOpacity:{value:.5},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total"},y2:{value:0}},update:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total"},y2:{scale:"y",value:-10},width:{value:2}}}},{type:"rect",from:{data:"table"},properties:{update:{fill:{value:"#fff"},x:{scale:"x",field:"data._id.data_balanco",offset:0},y:{group:"height"},width:{scale:"width",field:"index",mult:.835},height:{value:2}}}},{type:"area",from:{data:"table"},properties:{enter:{interpolate:{value:"monotone"},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total",offset:5},y2:{scale:"y",value:0},fill:{value:"white"},fillOpacity:{value:.3}},update:{interpolate:{value:"monotone"},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total",offset:5},y2:{scale:"y",value:0}}}},{type:"symbol",from:{data:"table"},properties:{enter:{shape:{value:"circle"},size:{value:50},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total",offset:5},y2:{scale:"y",value:0},fill:{value:"white"}},update:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total",offset:5},y2:{scale:"y",value:0}}}},{type:"line",from:{data:"table"},properties:{enter:{interpolate:{value:"monotone"},x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total"},y2:{scale:"y",value:0},stroke:{value:"white"},strokeWidth:{value:2}},update:{x:{scale:"x",field:"data._id.data_balanco"},y:{scale:"y",field:"data.valor_total",offset:5},y2:{scale:"y",value:0}}}}]}}}]).service("evolucaoChart",["PacService","evolucaoSpec",function(a,b){var c=this;this.spec=b;var d=new a(function(a){a._id.data_balanco=a._id.data_balanco.substring(3)},function(a){a.valor_total="",a.label=""});this.carregarCategoria=function(a){d.get(a).success(function(a){c.data=a})}}]),angular.module("pacApp").factory("distribuicaoSpec",["chartSize",function(a){return function(b,c,d){return{width:a(b).width,height:a(b).height,padding:{top:20,left:0,bottom:30,right:0},data:[{name:"table"}],scales:[{name:"x",type:"ordinal",points:!0,padding:1.5,range:"width",domain:{data:"table",field:"data._id"}},{name:"y",range:"height",nice:!0,domain:{data:"table",field:"data.valor_total"},domainMax:d.domainMax||void 0}],axes:[{type:"x",scale:"x",properties:{axis:{strokeWidth:{value:0}},majorTicks:{strokeWidth:{value:0}},labels:{fill:{value:"#FFF"},angle:{value:0},fontSize:{value:12},fontWeight:{value:"200"},align:{value:"center"}}}}],marks:[{key:"data._id",type:"rect",from:{data:"table"},properties:{enter:{fill:{value:"#fff"},x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.valor_total"},y2:{value:0},width:{scale:"x",band:!0,offset:-30}},update:{x:{scale:"x",field:"data._id",offset:15},y:{scale:"y",field:"data.valor_total"},y2:{scale:"y",value:-10},width:{scale:"x",band:!0,offset:-30}}}},{type:"text",from:{data:"table"},properties:{enter:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.valor_total",offset:-10},fill:{value:"#fff"},text:{field:"data.label"},align:{value:"center"},fontSize:{value:14}},update:{x:{scale:"x",field:"data._id"},y:{scale:"y",field:"data.valor_total",offset:-10},text:{field:"data.label"}}}}]}}}]).service("distribuicaoChart",["PacService","distribuicaoSpec",function(a,b){var c=this;this.spec=b;var d=new a(function(a){"Equipamentos - Estradas Vicinais"===a._id&&(a._id="Estradas")},function(a){a.valor_total=""});this.carregarCategoria=function(a){d.get(a+"/by_type").success(function(a){c.data=a})}}]),angular.module("pacApp").factory("estagioSpec",["chartSize",function(a){return function(b,c){for(var d=[],e=[],f=0;f<c.table.length;f++)d.push(c.table[f]._id+" :  "+c.table[f].total),e.push(c.table[f].color);return{width:a(b).width,height:400,padding:{top:20,left:10,bottom:30,right:10},data:[{name:"table",transform:[{type:"pie",value:"data.total"}]}],scales:[{name:"r",type:"sqrt",domain:{data:"table",field:"data.total"},range:[130,180]},{name:"size",type:"ordinal",sort:!0,domain:{data:"table",field:"data.total"},range:[100,1e3]},{name:"estagios",type:"ordinal",sort:!0,domain:{data:"table",field:"data.total"},range:d},{name:"color",type:"ordinal",sort:!0,domain:{data:"table",field:"data.total"},range:e}],legends:[{size:"size",fill:"color",orient:"left",properties:{title:{fontSize:{value:16}},symbols:{stroke:{value:"transparent"},shape:{value:"circle"}},labels:{fill:{value:"#656567"},fontSize:{value:16},fontFamily:{value:"Helvetica"},text:{scale:"estagios"}},legend:{padding:{value:10},stroke:{value:"#ccc"},strokeWidth:{value:0},x:{value:0},y:{value:10}}}}],marks:[{type:"arc",from:{data:"table"},properties:{enter:{x:{group:"width",mult:.7},y:{group:"height",mult:.5},startAngle:{field:"startAngle"},endAngle:{field:"endAngle"},innerRadius:{value:80},outerRadius:{scale:"r",field:"data.total"},fill:{field:"data.color"},stroke:{value:"white"},strokeWidth:{value:2}},update:{x:{group:"width",mult:.7},y:{group:"height",mult:.5},startAngle:{field:"startAngle"},endAngle:{field:"endAngle"},innerRadius:{value:80},outerRadius:{scale:"r",field:"data.total"}}}}]}}}]).service("estagioChart",["PacService","estagioSpec",function(a,b){var c=this,d=["#FBAD2F","#68D286","#1DA1CD","#EB585C","#A085C6","#FF8FB4","#FDD26D"];this.spec=b;var e=new a(function(a,b){a.color=d[b%d.length]},function(a){a.total=10});this.carregarCategoria=function(a){e.get(a+"/by_status").success(function(a){c.data=a})}}]);