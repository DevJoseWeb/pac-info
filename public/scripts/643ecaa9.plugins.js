vg=function(a,b){function c(a){return a.replace(M,"$1\\'")}function d(a,b,c){var d=0,e=a.split(N);return a=c?(e=e.reverse()).filter(function(a){return d+=a.length,b>=d}).reverse():e.filter(function(a){return d+=a.length,b>=d}),a.length?a.join("").trim():e[0].slice(0,b)}function e(a){K.config.isNode?process.stderr.write(a+"\n"):console.log(a)}function f(a){return a.__vgtree__=!0,a.nodes=function(){return g(this,[])},a}function g(a,b){var c,d=a.values,e=d?d.length:0;for(b.push(a),c=0;e>c;++c)g(d[c],b);return b}function h(a){var b,c,d=a;if(K.isArray(a))for(d=[],b=0,c=a.length;c>b;++b)d.push(h(a[b]));else if(K.isObject(a)){d={};for(b in a)d[b]=h(a[b])}return d}function i(a){return P.test(a)}function j(a){return 0===a.indexOf(Q)}function k(b,c){K.log("LOAD: "+b),a.xhr(b,function(a,b){b&&(b=b.responseText),c(a,b)})}function m(a,b){K.log("LOAD FILE: "+a);var c=a.indexOf(Q);c>=0&&(a=a.slice(Q.length)),require("fs").readFile(a,b)}function n(a,b){K.log("LOAD HTTP: "+a);var c=require("http").request(a,function(a){var c=0,d=new Buffer(parseInt(a.headers["content-length"],10));a.on("error",function(a){b(a,null)}),a.on("data",function(a){a.copy(d,c),c+=a.length}),a.on("end",function(){b(null,d)})});c.on("error",function(a){b(a)}),c.end()}function o(a,b,c){if(d=[],c&&b.length>1){for(var d,e,f,g=p(a.domain()),h=-1,i=b.length,j=(b[1]-b[0])/++c;++h<i;)for(e=c;--e>0;)(f=+b[h]-e*j)>=g[0]&&d.push(f);for(--h,e=0;++e<c&&(f=+b[h]+e*j)<g[1];)d.push(f)}return d}function p(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function q(a){return a.rangeExtent?a.rangeExtent():p(a.range())}function r(a,b,c,d,e,f){e=Math.max(e,0)+f,("left"===a||"top"===a)&&(e*=-1),"top"===a||"bottom"===a?(K.extend(b.properties.enter,{x:c,y:{value:e}}),K.extend(b.properties.update,{x:d,y:{value:e},align:{value:"center"},baseline:{value:T[a]}})):(K.extend(b.properties.enter,{x:{value:e},y:c}),K.extend(b.properties.update,{x:{value:e},y:d,align:{value:S[a]},baseline:{value:"middle"}}))}function s(a,b,c,d,e){var f="left"===a||"top"===a?-1:1;e=1/0===e?"top"===a||"bottom"===a?{group:"mark.group.height",mult:-f}:{group:"mark.group.width",mult:-f}:{value:f*e},"top"===a||"bottom"===a?(K.extend(b.properties.enter,{x:c,y:{value:0},y2:e}),K.extend(b.properties.update,{x:d,y:{value:0},y2:e}),K.extend(b.properties.exit,{x:d})):(K.extend(b.properties.enter,{x:{value:0},x2:e,y:c}),K.extend(b.properties.update,{x:{value:0},x2:e,y:d}),K.extend(b.properties.exit,{y:d}))}function u(a,b,c,d){var e=~~((c[1]-c[0])/2),f="top"===a||"left"===a?-1:1;"bottom"===a||"top"===a?K.extend(b.properties.update,{x:{value:e},y:{value:f*d},angle:{value:0}}):K.extend(b.properties.update,{x:{value:f*d},y:{value:e},angle:{value:-90}})}function v(a,b,c,d){var e;("top"===a||"left"===a)&&(d=-1*d),e="bottom"===a||"top"===a?"M"+c[0]+","+d+"V0H"+c[1]+"V"+d:"M"+d+","+c[0]+"H0V"+c[1]+"H"+d,b.properties.update.path={value:e}}function w(a,b,c){var d=c?{}:a,e=a.mark.def.offset,f=a.mark.def.orient,g=b.width,h=b.height;switch(K.isObject(e)&&(e=-b.scales[e.scale](e.value)),f){case"left":d.x=-e,d.y=0;break;case"right":d.x=g+e,d.y=0;break;case"bottom":d.x=0,d.y=h+e;break;case"top":d.x=0,d.y=-e;break;default:d.x=0,d.y=0}c&&c.interpolate(a,d)}function z(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:K.config.axis.tickColor},strokeWidth:{value:K.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function A(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:K.config.axis.tickLabelColor},font:{value:K.config.axis.tickLabelFont},fontSize:{value:K.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function B(){return{type:"text",interactive:!0,properties:{enter:{font:{value:K.config.axis.titleFont},fontSize:{value:K.config.axis.titleFontSize},fontWeight:{value:K.config.axis.titleFontWeight},fill:{value:K.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function C(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:K.config.axis.axisColor},strokeWidth:{value:K.config.axis.axisWidth}},update:{}}}}function D(a,b,c){var d=c?{}:a,e=a.mark.def.offset,f=a.mark.def.orient,g=2*a.mark.def.padding,h=b.bounds?b.bounds.x1:0,i=b.bounds?b.bounds.x2:b.width,j=~~a.bounds.width()+(d.width?0:g),k=~~a.bounds.height()+(d.height?0:g);switch(d.x=.5,d.y=.5,d.width=j,d.height=k,f){case"left":d.x+=h-e-j;break;case"right":d.x+=i+e}a.mark.def.properties.enter(a,b,c)}function E(a,b,c,d,e){var f=a.properties.enter,g=a.properties.update;b&&(f.size=g.size={scale:b.scaleName,field:"data"}),c&&(f.shape=g.shape={scale:c.scaleName,field:"data"}),d&&(f.fill=g.fill={scale:d.scaleName,field:"data"}),e&&(f.stroke=g.stroke={scale:e.scaleName,field:"data"})}function F(){var a=K.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:a.titleColor},font:{value:a.titleFont},fontSize:{value:a.titleFontSize},fontWeight:{value:a.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function G(){var a=K.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:a.symbolShape},size:{value:a.symbolSize},stroke:{value:a.symbolColor},strokeWidth:{value:a.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function H(){var a=K.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:a.labelColor},font:{value:a.labelFont},fontSize:{value:a.labelFontSize},align:{value:a.labelAlign},baseline:{value:a.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function I(){var a=K.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:a.gradientWidth},height:{value:a.gradientHeight},stroke:{value:a.gradientStrokeColor},strokeWidth:{value:a.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function J(){var a=K.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:a.labelColor},font:{value:a.labelFont},fontSize:{value:a.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var K={version:"1.3.3",d3:a,topojson:b},L=Object.prototype.toString;K.isObject=function(a){return a===Object(a)},K.isFunction=function(a){return"[object Function]"==L.call(a)},K.isString=function(a){return"[object String]"==L.call(a)},K.isArray=Array.isArray||function(a){return"[object Array]"==L.call(a)},K.isNumber=function(a){return"[object Number]"==L.call(a)},K.isBoolean=function(a){return"[object Boolean]"==L.call(a)},K.isTree=function(a){return a&&a.__vgtree__},K.tree=function(a,b){var c=[a];return c.__vgtree__=!0,c.children=b||"children",c},K.number=function(a){return+a},K.boolean=function(a){return!!a},K.identity=function(a){return a},K.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},K.duplicate=function(a){return JSON.parse(JSON.stringify(a))},K.field=function(a){return a.split("\\.").map(function(a){return a.split(".")}).reduce(function(a,b){return a.length&&(a[a.length-1]+="."+b.shift()),a.push.apply(a,b),a},[])},K.accessor=function(a){var b;return K.isFunction(a)||null==a?a:K.isString(a)&&(b=K.field(a)).length>1?function(a){return b.reduce(function(a,b){return a[b]},a)}:function(b){return b[a]}},K.comparator=function(a){var b=[];return void 0===a&&(a=[]),a=K.array(a).map(function(a){var c=1;return"-"===a[0]?(c=-1,a=a.slice(1)):"+"===a[0]&&(c=1,a=a.slice(1)),b.push(c),K.accessor(a)}),function(c,d){var e,f,g,h,i;for(e=0,f=a.length;f>e;++e){if(g=a[e],h=g(c),i=g(d),i>h)return-1*b[e];if(h>i)return b[e]}return 0}},K.cmp=function(a,b){return b>a?-1:a>b?1:0},K.numcmp=function(a,b){return a-b},K.array=function(a){return null!=a?K.isArray(a)?a:[a]:[]},K.values=function(a){return K.isObject(a)&&!K.isArray(a)&&a.values?a.values:a},K.str=function(a){return K.isArray(a)?"["+a.map(K.str)+"]":K.isObject(a)?JSON.stringify(a):K.isString(a)?"'"+c(a)+"'":a};var M=/(^|[^\\])'/g;K.keys=function(a){var b=[];for(var c in a)b.push(c);return b},K.unique=function(a,b,c){if(!K.isArray(a)||0==a.length)return[];b=b||K.identity,c=c||[];for(var d,e=0,f=a.length;f>e;++e)d=b(a[e]),c.indexOf(d)<0&&c.push(d);return c},K.minIndex=function(a,b){if(!K.isArray(a)||0==a.length)return-1;b=b||K.identity;for(var c=0,d=b(a[0]),e=d,f=1,g=a.length;g>f;++f)e=b(a[f]),d>e&&(d=e,c=f);return c},K.maxIndex=function(a,b){if(!K.isArray(a)||0==a.length)return-1;b=b||K.identity;for(var c=0,d=b(a[0]),e=d,f=1,g=a.length;g>f;++f)e=b(a[f]),e>d&&(d=e,c=f);return c},K.truncate=function(a,b,c,e,f){var g=a.length;if(b>=g)return a;f=f||"...";var h=Math.max(0,b-f.length);switch(c){case"left":return f+(e?d(a,h,1):a.slice(g-h));case"middle":case"center":var i=Math.ceil(h/2),j=Math.floor(h/2);return(e?d(a,i):a.slice(0,i))+f+(e?d(a,j,1):a.slice(g-j));default:return(e?d(a,h):a.slice(0,h))+f}};var N=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;K.log=function(a){e("[Vega Log] "+a)},K.error=function(a){a="[Vega Err] "+a,e(a),"undefined"!=typeof alert&&alert(a)},K.config={},K.config.isNode="undefined"!=typeof exports&&this.exports!==exports,K.config.baseURL="",K.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',K.config.autopadInset=5,K.config.scale={time:a.time.scale,utc:a.time.scale.utc},K.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},K.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#fff",gridColor:"#d8d8d8",tickColor:"#fff",tickLabelColor:"#fff",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#fff",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},K.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#fff",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#fff",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},K.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},K.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},K.Bounds=function(){var a=function(a){this.clear(),a&&this.union(a)},b=a.prototype;return b.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},b.set=function(a,b,c,d){return this.x1=a,this.y1=b,this.x2=c,this.y2=d,this},b.add=function(a,b){return a<this.x1&&(this.x1=a),b<this.y1&&(this.y1=b),a>this.x2&&(this.x2=a),b>this.y2&&(this.y2=b),this},b.expand=function(a){return this.x1-=a,this.y1-=a,this.x2+=a,this.y2+=a,this},b.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},b.translate=function(a,b){return this.x1+=a,this.x2+=a,this.y1+=b,this.y2+=b,this},b.rotate=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=b-b*d+c*e,g=c-b*e-c*d,h=this.x1,i=this.x2,j=this.y1,k=this.y2;return this.clear().add(d*h-e*j+f,e*h+d*j+g).add(d*h-e*k+f,e*h+d*k+g).add(d*i-e*j+f,e*i+d*j+g).add(d*i-e*k+f,e*i+d*k+g)},b.union=function(a){return a.x1<this.x1&&(this.x1=a.x1),a.y1<this.y1&&(this.y1=a.y1),a.x2>this.x2&&(this.x2=a.x2),a.y2>this.y2&&(this.y2=a.y2),this},b.encloses=function(a){return a&&this.x1<=a.x1&&this.x2>=a.x2&&this.y1<=a.y1&&this.y2>=a.y2},b.intersects=function(a){return a&&!(this.x2<a.x1||this.x1>a.x2||this.y2<a.y1||this.y1>a.y2)},b.contains=function(a,b){return!(a<this.x1||a>this.x2||b<this.y1||b>this.y2)},b.width=function(){return this.x2-this.x1},b.height=function(){return this.y2-this.y1},a}(),K.Gradient=function(){function a(a){this.id="grad_"+O++,this.type=a||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var b=a.prototype;return b.stop=function(a,b){return this.stops.push({offset:a,color:b}),this},a}();var O=0;K.canvas={},K.canvas.path=function(){function b(a){var b,c,d,e=[];a=a.slice().replace(n[0],"###$1").split(n[1]).slice(1);for(var f,g,h=0,i=a.length;i>h;h++){b=a[h],c=b.slice(1).trim().replace(n[2],"$1###-").split(n[3]),g=[b.charAt(0)];for(var f=0,j=c.length;j>f;f++)d=parseFloat(c[f]),isNaN(d)||g.push(d);var k=g[0].toLowerCase(),l=m[k];if(g.length-1>l)for(var o=1,p=g.length;p>o;o+=l)e.push([g[0]].concat(g.slice(o,o+l)));else e.push(g)}return e}function c(a,b,c,d,g,h,i){for(var j=d[0],k=d[1],l=d[2],m=d[3],n=d[4],o=d[5],p=d[6],q=e(o,p,j,k,m,n,l,b,c),r=0;r<q.length;r++){var s=f.apply(null,q[r]);a.bezierCurveTo.apply(a,s),g.add(s[0]-h,s[1]-i),g.add(s[2]-h,s[3]-i),g.add(s[4]-h,s[5]-i)}}function d(a,b,c,d){for(var g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],m=c[5],n=c[6],o=e(m,n,g,h,j,k,i,a,b),p=0;p<o.length;p++){var q=f.apply(null,o[p]);d.add(q[0]-l,q[1]-t),d.add(q[2]-l,q[3]-t),d.add(q[4]-l,q[5]-t)}}function e(a,b,c,d,e,f,g,h,i){if(k=q.call(arguments),o[k])return o[k];var j=g*(Math.PI/180),l=Math.sin(j),m=Math.cos(j);c=Math.abs(c),d=Math.abs(d);var n=m*(h-a)*.5+l*(i-b)*.5,p=m*(i-b)*.5-l*(h-a)*.5,r=n*n/(c*c)+p*p/(d*d);r>1&&(r=Math.sqrt(r),c*=r,d*=r);var s=m/c,t=l/c,u=-l/d,v=m/d,w=s*h+t*i,x=u*h+v*i,y=s*a+t*b,z=u*a+v*b,A=(y-w)*(y-w)+(z-x)*(z-x),B=1/A-.25;0>B&&(B=0);var C=Math.sqrt(B);f==e&&(C=-C);var D=.5*(w+y)-C*(z-x),E=.5*(x+z)+C*(y-w),F=Math.atan2(x-E,w-D),G=Math.atan2(z-E,y-D),H=G-F;0>H&&1==f?H+=2*Math.PI:H>0&&0==f&&(H-=2*Math.PI);for(var I=Math.ceil(Math.abs(H/(.5*Math.PI+.001))),J=[],K=0;I>K;K++){var L=F+K*H/I,M=F+(K+1)*H/I;J[K]=[D,E,L,M,c,d,l,m]}return o[k]=J}function f(a,b,c,d,e,f,g,h){if(k=q.call(arguments),p[k])return p[k];var i=h*e,j=-g*f,l=g*e,m=h*f,n=Math.cos(c),o=Math.sin(c),r=Math.cos(d),s=Math.sin(d),t=.5*(d-c),u=Math.sin(.5*t),v=8/3*u*u/Math.sin(t),w=a+n-v*o,x=b+o+v*n,y=a+r,z=b+s,A=y+v*s,B=z-v*r;return p[k]=[i*w+j*x,l*w+m*x,i*A+j*B,l*A+m*B,i*y+j*z,l*y+m*z]}function g(a,b,d,e){var f,g,h,i,j,k=null,l=0,m=0,n=0,o=0,p=new K.Bounds;void 0==d&&(d=0),void 0==e&&(e=0),a.beginPath();for(var q=0,r=b.length;r>q;++q){switch(f=b[q],f[0]){case"l":l+=f[1],m+=f[2],a.lineTo(l+d,m+e),p.add(l,m);break;case"L":l=f[1],m=f[2],a.lineTo(l+d,m+e),p.add(l,m);break;case"h":l+=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"H":l=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"v":m+=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"V":m=f[1],a.lineTo(l+d,m+e),p.add(l,m);break;case"m":l+=f[1],m+=f[2],a.moveTo(l+d,m+e),p.add(l,m);break;case"M":l=f[1],m=f[2],a.moveTo(l+d,m+e),p.add(l,m);break;case"c":g=l+f[5],h=m+f[6],n=l+f[3],o=m+f[4],a.bezierCurveTo(l+f[1]+d,m+f[2]+e,n+d,o+e,g+d,h+e),p.add(l+f[1],m+f[2]),p.add(n,o),p.add(g,h),l=g,m=h;break;case"C":l=f[5],m=f[6],n=f[3],o=f[4],a.bezierCurveTo(f[1]+d,f[2]+e,n+d,o+e,l+d,m+e),p.add(f[1],f[2]),p.add(n,o),p.add(l,m);break;case"s":g=l+f[3],h=m+f[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+d,o+e,l+f[1]+d,m+f[2]+e,g+d,h+e),p.add(n,o),p.add(l+f[1],m+f[2]),p.add(g,h),n=l+f[1],o=m+f[2],l=g,m=h;break;case"S":g=f[3],h=f[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+d,o+e,f[1]+d,f[2]+e,g+d,h+e),l=g,m=h,p.add(f[1],f[2]),p.add(n,o),p.add(g,h),n=f[1],o=f[2];break;case"q":g=l+f[3],h=m+f[4],n=l+f[1],o=m+f[2],a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,p.add(n,o),p.add(g,h);break;case"Q":g=f[3],h=f[4],a.quadraticCurveTo(f[1]+d,f[2]+e,g+d,h+e),l=g,m=h,n=f[1],o=f[2],p.add(n,o),p.add(g,h);break;case"t":g=l+f[1],h=m+f[2],null===k[0].match(/[QqTt]/)?(n=l,o=m):"t"===k[0]?(n=2*l-i,o=2*m-j):"q"===k[0]&&(n=2*l-n,o=2*m-o),i=n,j=o,a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,n=l+f[1],o=m+f[2],p.add(n,o),p.add(g,h);break;case"T":g=f[1],h=f[2],n=2*l-n,o=2*m-o,a.quadraticCurveTo(n+d,o+e,g+d,h+e),l=g,m=h,p.add(n,o),p.add(g,h);break;case"a":c(a,l+d,m+e,[f[1],f[2],f[3],f[4],f[5],f[6]+l+d,f[7]+m+e],p,d,e),l+=f[6],m+=f[7];break;case"A":c(a,l+d,m+e,[f[1],f[2],f[3],f[4],f[5],f[6]+d,f[7]+e],p,d,e),l=f[6],m=f[7];break;case"z":case"Z":a.closePath()}k=f}return p.translate(d,e)}function h(a,b){for(var c,e,f,g,h,i=null,j=0,k=0,l=0,m=0,n=0,o=a.length;o>n;++n){switch(c=a[n],c[0]){case"l":j+=c[1],k+=c[2],b.add(j,k);break;case"L":j=c[1],k=c[2],b.add(j,k);break;case"h":j+=c[1],b.add(j,k);break;case"H":j=c[1],b.add(j,k);break;case"v":k+=c[1],b.add(j,k);break;case"V":k=c[1],b.add(j,k);break;case"m":j+=c[1],k+=c[2],b.add(j,k);break;case"M":j=c[1],k=c[2],b.add(j,k);break;case"c":e=j+c[5],f=k+c[6],l=j+c[3],m=k+c[4],b.add(j+c[1],k+c[2]),b.add(l,m),b.add(e,f),j=e,k=f;break;case"C":j=c[5],k=c[6],l=c[3],m=c[4],b.add(c[1],c[2]),b.add(l,m),b.add(j,k);break;case"s":e=j+c[3],f=k+c[4],l=2*j-l,m=2*k-m,b.add(l,m),b.add(j+c[1],k+c[2]),b.add(e,f),l=j+c[1],m=k+c[2],j=e,k=f;break;case"S":e=c[3],f=c[4],l=2*j-l,m=2*k-m,j=e,k=f,b.add(c[1],c[2]),b.add(l,m),b.add(e,f),l=c[1],m=c[2];break;case"q":e=j+c[3],f=k+c[4],l=j+c[1],m=k+c[2],j=e,k=f,b.add(l,m),b.add(e,f);break;case"Q":e=c[3],f=c[4],j=e,k=f,l=c[1],m=c[2],b.add(l,m),b.add(e,f);break;case"t":e=j+c[1],f=k+c[2],null===i[0].match(/[QqTt]/)?(l=j,m=k):"t"===i[0]?(l=2*j-g,m=2*k-h):"q"===i[0]&&(l=2*j-l,m=2*k-m),g=l,h=m,j=e,k=f,l=j+c[1],m=k+c[2],b.add(l,m),b.add(e,f);break;case"T":e=c[1],f=c[2],l=2*j-l,m=2*k-m,j=e,k=f,b.add(l,m),b.add(e,f);break;case"a":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6]+j,c[7]+k],b),j+=c[6],k+=c[7];break;case"A":d(j,k,[c[1],c[2],c[3],c[4],c[5],c[6],c[7]],b),j=c[6],k=c[7];break;case"z":case"Z":}i=c}return b}function i(b){var c=b[0],d=a.svg.area().x(function(a){return a.x}).y1(function(a){return a.y}).y0(function(a){return a.y+a.height});return c.interpolate&&d.interpolate(c.interpolate),null!=c.tension&&d.tension(c.tension),d(b)}function j(b){var c=b[0],d=a.svg.line().x(function(a){return a.x}).y(function(a){return a.y});return c.interpolate&&d.interpolate(c.interpolate),null!=c.tension&&d.tension(c.tension),d(b)}var k,m={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},n=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],o={},p={},q=Array.prototype.join;return{parse:b,render:g,bounds:h,area:i,line:j}}(),K.canvas.marks=function(){function a(a,b){var c=b.x||0,d=b.y||0,e=b.innerRadius||0,f=b.outerRadius||0,g=(b.startAngle||0)-Math.PI/2,h=(b.endAngle||0)-Math.PI/2;a.beginPath(),0===e?a.moveTo(c,d):a.arc(c,d,e,g,h,0),a.arc(c,d,f,h,g,1),a.closePath()}function b(a,b){var c=b[0],d=c.mark,e=d.cache||(d.cache=A(K.canvas.path.area(b)));B(a,e)}function c(a,b){var c=b[0],d=c.mark,e=d.cache||(d.cache=A(K.canvas.path.line(b)));B(a,e)}function d(a,b){if(null!=b.path){var c=b.cache||(b.cache=A(b.path));return B(a,c,b.x,b.y)}}function e(a,b){a.beginPath();var c,d,e,f,g=null!=b.size?b.size:100,h=b.x,i=b.y;if(null==b.shape||"circle"===b.shape)return c=Math.sqrt(g/Math.PI),a.arc(h,i,c,0,2*Math.PI,0),a.closePath(),void 0;switch(b.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,a.moveTo(h-d,i-c),a.lineTo(h-c,i-c),a.lineTo(h-c,i-d),a.lineTo(h+c,i-d),a.lineTo(h+c,i-c),a.lineTo(h+d,i-c),a.lineTo(h+d,i+c),a.lineTo(h+c,i+c),a.lineTo(h+c,i+d),a.lineTo(h-c,i+d),a.lineTo(h-c,i+c),a.lineTo(h-d,i+c);break;case"diamond":f=Math.sqrt(g/(2*D)),e=f*D,a.moveTo(h,i-f),a.lineTo(h+e,i),a.lineTo(h,i+f),a.lineTo(h-e,i);break;case"square":d=Math.sqrt(g),c=d/2,a.rect(h-c,i-c,d,d);break;case"triangle-down":e=Math.sqrt(g/C),f=e*C/2,a.moveTo(h,i+f),a.lineTo(h+e,i-f),a.lineTo(h-e,i-f);break;case"triangle-up":e=Math.sqrt(g/C),f=e*C/2,a.moveTo(h,i-f),a.lineTo(h+e,i+f),a.lineTo(h-e,i+f)}a.closePath()}function f(a,b){var d=b[0],e=d.strokeWidth,f=d.strokeCap;a.lineWidth=null!=e?e:K.config.render.lineWidth,a.lineCap=null!=f?f:K.config.render.lineCap,c(a,b)}function g(a,b){var c=b.x||0,d=b.y||0,e=null!=b.x2?b.x2:c,f=null!=b.y2?b.y2:d,g=b.strokeWidth,h=b.strokeCap;a.lineWidth=null!=g?g:K.config.render.lineWidth,a.lineCap=null!=h?h:K.config.render.lineCap,a.beginPath(),a.moveTo(c,d),a.lineTo(e,f)}function h(a,b,c,d){var e,f,g,h=c.fill,i=c.stroke;a(b,d),e=null==c.opacity?1:c.opacity,0!=e&&(h||i)&&(h&&(b.globalAlpha=e*(null==c.fillOpacity?1:c.fillOpacity),b.fillStyle=q(b,c,h),b.fill()),i&&(g=null!=(g=c.strokeWidth)?g:K.config.render.lineWidth,g>0&&(b.globalAlpha=e*(null==c.strokeOpacity?1:c.strokeOpacity),b.strokeStyle=q(b,c,i),b.lineWidth=g,b.lineCap=null!=(f=c.strokeCap)?f:K.config.render.lineCap,b.vgLineDash(c.strokeDash||null),b.vgLineDashOffset(c.strokeDashOffset||0),b.stroke())))}function i(a,b,c,d){var e,f,g;for(e=0,f=c.items.length;f>e;++e)g=c.items[e],(!d||d.intersects(g.bounds))&&h(a,b,g,g)}function j(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m,n=b.items,o=0,p=n.length;p>o;++o)d=n[o],(!c||c.intersects(d.bounds))&&(j=d.x||0,k=d.y||0,l=d.width||0,m=d.height||0,g=null==d.opacity?1:d.opacity,0!=g&&((e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=q(a,d,e),a.fillRect(j,k,l,m)),(f=d.stroke)&&(i=null!=(i=d.strokeWidth)?i:K.config.render.lineWidth,i>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(a,d,f),a.lineWidth=i,a.lineCap=null!=(h=d.strokeCap)?h:K.config.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.strokeRect(j,k,l,m)))))}function k(a,b,c){if(b.items.length)for(var d,e,f,g,h,i,j,k,l,m=b.items,n=0,o=m.length;o>n;++n)d=m[n],(!c||c.intersects(d.bounds))&&(i=d.x||0,j=d.y||0,k=null!=d.x2?d.x2:i,l=null!=d.y2?d.y2:j,f=null==d.opacity?1:d.opacity,0!=f&&(e=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:K.config.render.lineWidth,h>0&&(a.globalAlpha=f*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(a,d,e),a.lineWidth=h,a.lineCap=null!=(g=d.strokeCap)?g:K.config.render.lineCap,a.vgLineDash(d.strokeDash||null),a.vgLineDashOffset(d.strokeDashOffset||0),a.beginPath(),a.moveTo(i,j),a.lineTo(k,l),a.stroke())))}function l(a,b,c){if(b.items.length)for(var d,e=this,f=b.items,g=0,h=f.length;h>g;++g)if(d=f[g],!c||c.intersects(d.bounds)){d.image&&d.image.url===d.url||(d.image=e.loadImage(d.url),d.image.url=d.url);var i,j,k,l,m;k=d.width||d.image&&d.image.width||0,l=d.height||d.image&&d.image.height||0,i=(d.x||0)-("center"===d.align?k/2:"right"===d.align?k:0),j=(d.y||0)-("middle"===d.baseline?l/2:"bottom"===d.baseline?l:0),d.image.loaded&&(a.globalAlpha=null!=(m=d.opacity)?m:1,a.drawImage(d.image,i,j,k,l))}}function m(a,b,c){if(b.items.length)for(var d,e,f,g,h,i=b.items,j=0,k=i.length;k>j;++j)d=i[j],(!c||c.intersects(d.bounds))&&(a.font=K.scene.fontString(d),a.textAlign=d.align||"left",a.textBaseline=d.baseline||"alphabetic",g=null==d.opacity?1:d.opacity,0!=g&&(d.angle?(a.save(),a.translate(d.x||0,d.y||0),a.rotate(d.angle*Math.PI/180),x=d.dx||0,y=d.dy||0):(x=(d.x||0)+(d.dx||0),y=(d.y||0)+(d.dy||0)),(e=d.fill)&&(a.globalAlpha=g*(null==d.fillOpacity?1:d.fillOpacity),a.fillStyle=q(a,d,e),a.fillText(d.text,x,y)),(f=d.stroke)&&(h=null!=(h=d.strokeWidth)?h:1,h>0&&(a.globalAlpha=g*(null==d.strokeOpacity?1:d.strokeOpacity),a.strokeStyle=q(d,f),a.lineWidth=h,a.strokeText(d.text,x,y))),d.angle&&a.restore()))}function n(a){return function(b,c,d){i(a,b,c,d)}}function o(a){return function(b,c,d){c.items.length&&(!d||d.intersects(c.items[0].bounds))&&h(a,b,c.items[0],c.items)}}function p(a,b,c){if(b.items.length){var d,e,f,g,h,i,k,l,m,n=b.items,o=this;for(j(a,b,c),i=0,k=n.length;k>i;++i){for(d=n[i],e=d.axisItems||[],f=d.legendItems||[],g=d.x||0,h=d.y||0,a.save(),a.translate(g,h),d.clip&&(a.beginPath(),a.rect(0,0,d.width||0,d.height||0),a.clip()),c&&c.translate(-g,-h),l=0,m=e.length;m>l;++l)"back"===e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=d.items.length;m>l;++l)o.draw(a,d.items[l],c);for(l=0,m=e.length;m>l;++l)"back"!==e[l].def.layer&&o.draw(a,e[l],c);for(l=0,m=f.length;m>l;++l)o.draw(a,f[l],c);c&&c.translate(g,h),a.restore()}}}function q(a,b,c){return c.id?r(a,c,b.bounds):c}function r(a,b,c){var d,e,f=c.width(),g=c.height(),h=c.x1+b.x1*f,i=c.y1+b.y1*g,j=c.x1+b.x2*f,k=c.y1+b.y2*g,l=a.createLinearGradient(h,i,j,k),m=b.stops;for(d=0,e=m.length;e>d;++d)l.addColorStop(m[d].offset,m[d].color);return l}function s(a,b,c,d,e,f){if(0===b.items.length||b.bounds&&!b.bounds.contains(e,f))return!1;var g,h,i,j,k,l,m,n=b.items,o=this;for(l=n.length;--l>=0;){for(h=n[l],j=h.x||0,k=h.y||0,a.save(),a.translate(j,k),m=h.items.length;--m>=0;)if(g=h.items[m],g.interactive!==!1&&(i=o.pick(g,c,d,e-j,f-k)))return a.restore(),i;a.restore()}return b.interactive?t(F.rect,a,b,c,d,e,f):!1}function t(a,b,c,d,e,f,g){if(!c.items.length)return!1;var h,i,j;for(1!==b._ratio&&(d*=b._ratio,e*=b._ratio),j=c.items.length;--j>=0;)if(h=c.items[j],i=h.bounds,(!i||i.contains(f,g))&&i&&a(b,h,d,e,f,g))return h;return!1}function u(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),F.area(a,h,c,d)?h[0]:!1)}function v(a,b,c,d,e,f){if(!b.items.length)return!1;var g,h=b.items;return g=h[0].bounds,g&&!g.contains(e,f)?!1:(1!==a._ratio&&(c*=a._ratio,d*=a._ratio),F.line(a,h,c,d)?h[0]:!1)}function w(a){return function(b,c,d,e,f,g){return t(a,b,c,d,e,f,g)}}function z(a,b,c,d,e,f){if(!b.fontSize)return!1;if(!b.angle)return!0;var g=K.scene.bounds.text(b,E,!0),h=-b.angle*Math.PI/180,i=Math.cos(h),j=Math.sin(h),c=b.x,d=b.y,k=i*e-j*f+(c-c*i+d*j),l=j*e+i*f+(d-c*j-d*i);return g.contains(k,l)}var A=K.canvas.path.parse,B=K.canvas.path.render,C=(Math.PI/2,Math.sqrt(3)),D=Math.tan(30*Math.PI/180),E=new K.Bounds,F={text:z,rect:function(){return!0},image:function(){return!0},rule:function(a,b,c,d){return a.isPointInStroke?(g(a,b),a.isPointInStroke(c,d)):!1},line:function(a,b,c,d){return a.isPointInStroke?(f(a,b),a.isPointInStroke(c,d)):!1},arc:function(b,c,d,e){return a(b,c),b.isPointInPath(d,e)},area:function(a,c,d,e){return b(a,c),a.isPointInPath(d,e)},path:function(a,b,c,e){return d(a,b),a.isPointInPath(c,e)},symbol:function(a,b,c,d){return e(a,b),a.isPointInPath(c,d)}};return{draw:{group:p,area:o(b),line:o(c),arc:n(a),path:n(d),symbol:n(e),rect:j,rule:k,text:m,image:l,drawOne:o,drawAll:n},pick:{group:s,area:u,line:v,arc:w(F.arc),path:w(F.path),symbol:w(F.symbol),rect:w(F.rect),rule:w(F.rule),text:w(F.text),image:w(F.image),pickAll:t}}}(),K.canvas.Renderer=function(){function b(a,b){var c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=c/d;if(c!==d){var f=a.width,g=a.height;a.setAttribute("width",f*e),a.setAttribute("height",g*e),a.style.width=f+"px",a.style.height=g+"px"}return e}function c(a){if(!a.vgLineDash){var b=[];a.setLineDash?(a.vgLineDash=function(a){this.setLineDash(a||b)},a.vgLineDashOffset=function(a){this.lineDashOffset=a}):void 0!==a.webkitLineDash?(a.vgLineDash=function(a){this.webkitLineDash=a||b},a.vgLineDashOffset=function(a){this.webkitLineDashOffset=a}):void 0!==a.mozDash?(a.vgLineDash=function(a){this.mozDash=a},a.vgLineDashOffset=function(){}):(a.vgLineDash=function(){},a.vgLineDashOffset=function(){})}}function d(a,b){for(var c=new K.Bounds(b);null!=(a=a.mark.group);)c.translate(a.x||0,a.y||0);return c}function e(a){return a?K.array(a).reduce(function(a,b){return a.union(d(b,b.bounds)).union(d(b,b["bounds:prev"]))},new K.Bounds):null}function f(a,b){var c=null;return b&&(c=new K.Bounds(b).round(),a.beginPath(),a.rect(c.x1,c.y1,c.width(),c.height()),a.clip()),c}var g=function(){this._ctx=null,this._el=null,this._imgload=0},h=g.prototype;return h.initialize=function(b,c,d,e){if(this._el=b,!b)return this;var f=a.select(b).selectAll("canvas.marks").data([1]);return f.enter().append("canvas").attr("class","marks"),f.exit().remove(),this.resize(c,d,e)},h.resize=function(d,e,f){if(this._width=d,this._height=e,this._padding=f,this._el){var g=a.select(this._el).select("canvas.marks");g.attr("width",d+f.left+f.right).attr("height",e+f.top+f.bottom);var h;this._ctx=g.node().getContext("2d"),this._ctx._ratio=h=b(g.node(),this._ctx)||1,this._ctx.setTransform(h,0,0,h,h*f.left,h*f.top)}return c(this._ctx),this},h.context=function(a){return a?(this._ctx=a,this):this._ctx},h.element=function(){return this._el},h.pendingImages=function(){return this._imgload},h.render=function(a,b){var c,d=this._ctx,g=this._padding,h=this._width+g.left+g.right,i=this._height+g.top+g.bottom,j=null;this._scene=a,d.save(),j=f(d,e(b)),d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,j),b&&(d.restore(),d.save(),c=f(d,e(b)),j.encloses(c)||(d.clearRect(-g.left,-g.top,h,i),this.draw(d,a,c))),d.restore(),this._scene=null},h.draw=function(a,b,c){var d=b.marktype,e=K.canvas.marks.draw[d];e.call(this,a,b,c)},h.renderAsync=function(a){var b=this;b._async_id&&clearTimeout(b._async_id),b._async_id=setTimeout(function(){b.render(a),delete b._async_id},50)},h.loadImage=function(a){var b,c=this,d=c._scene,e=null;return c._imgload+=1,K.config.isNode?(e=new(require("canvas").Image),K.data.load(a,function(a,b){return a?(K.error(a),void 0):(e.src=b,e.loaded=!0,c._imgload-=1,void 0)})):(e=new Image,b=K.config.baseURL+a,e.onload=function(){K.log("LOAD IMAGE: "+b),e.loaded=!0,c._imgload-=1,c.renderAsync(d)},e.src=b),e},g}(),K.canvas.Handler=function(){function b(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var c=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},d=c.prototype;d.initialize=function(b,c,f){this._el=a.select(b).node(),this._canvas=a.select(b).select("canvas.marks").node(),this._padding=c,this._obj=f||null;var g=this._canvas,h=this;return e.forEach(function(a){g.addEventListener(a,function(b){d[a].call(h,b)})}),this},d.padding=function(a){return this._padding=a,this},d.model=function(a){return arguments.length?(this._model=a,this):this._model},d.handlers=function(){var a=this._handlers;return K.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])};var e=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return e.forEach(function(a){d[a]=function(b){this.fire(a,b)}}),e.push("mousemove"),e.push("mouseout"),d.mousemove=function(a){var b=this._padding,c=a.target.getBoundingClientRect(),d=a.clientX-c.left,e=a.clientY-c.top,f=this._active,g=this.pick(this._model.scene(),d,e,d-b.left,e-b.top);return g===f?(this.fire("mousemove",a),void 0):(f&&this.fire("mouseout",a),this._active=g,g&&this.fire("mouseover",a),void 0)},d.mouseout=function(a){this._active&&this.fire("mouseout",a),this._active=null},d.DOMMouseScroll=function(a){this.fire("mousewheel",a)},d.fire=function(a,b){var c=this._active,d=this._handlers[a];if(c&&d)for(var e=0,f=d.length;f>e;++e)d[e].handler.call(this._obj,b,c)},d.on=function(a,c){var d=b(a),e=this._handlers;return e=e[d]||(e[d]=[]),e.push({type:a,handler:c}),this},d.off=function(a,c){var d=b(a),e=this._handlers[d];if(e){for(var f=e.length;--f>=0;)e[f].type===a&&(c&&e[f].handler!==c||e.splice(f,1));return this}},d.context=function(){return this._canvas.getContext("2d")},d.pick=function(a,b,c,d,e){var f=this.context(),g=a.marktype,h=K.canvas.marks.pick[g];return h.call(this,f,a,b,c,d,e)},c}(),K.svg={},K.svg.marks=function(){function b(a){return a.x||0
}function c(a){return a.y||0}function d(a){return a.y+a.height||0}function e(a){return null==a.size?100:a.size}function f(a){return a.shape||"circle"}function g(a){var b,c,d,e,f,g=a.mark?a:a.length?a[0]:null;if(null!==g)for(b=0,c=E.length;c>b;++b)d=E[b],e=D[d],f=g[d],null==f?"fill"===e?this.style.setProperty(e,"none",null):this.style.removeProperty(e):(f.id&&(K.svg._cur._defs.gradient[f.id]=f,f="url(#"+f.id+")"),this.style.setProperty(e,f+"",null))}function h(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",w(a))}function i(a){if(a.length){var b=a[0];x.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",x(a))}}function j(a){if(a.length){var b=a[0];y.interpolate(b.interpolate||"linear").tension(null==b.tension?.7:b.tension),this.setAttribute("d",y(a))}}function k(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),null!=a.path&&this.setAttribute("d",a.path)}function l(a){this.setAttribute("x",a.x||0),this.setAttribute("y",a.y||0),this.setAttribute("width",a.width||0),this.setAttribute("height",a.height||0)}function m(a){var b=a.x||0,c=a.y||0;this.setAttribute("x1",b),this.setAttribute("y1",c),this.setAttribute("x2",null!=a.x2?a.x2:b),this.setAttribute("y2",null!=a.y2?a.y2:c)}function n(a){var b=a.x||0,c=a.y||0;this.setAttribute("transform","translate("+b+","+c+")"),this.setAttribute("d",z(a))}function o(a){var b=a.width||a.image&&a.image.width||0,c=a.height||a.image&&a.image.height||0,d=a.x-("center"===a.align?b/2:"right"===a.align?b:0),e=a.y-("middle"===a.baseline?c/2:"bottom"===a.baseline?c:0),f=K.config.baseURL+a.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",f),this.setAttribute("x",d),this.setAttribute("y",e),this.setAttribute("width",b),this.setAttribute("height",c)}function p(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:K.config.render.fontSize)+"px "+(a.font||K.config.render.font)}function q(a){var b=a.x||0,c=a.y||0,d=a.dx||0,e=a.dy||0,f=a.angle||0,g=C[a.align||"left"],h="top"===a.baseline?".9em":"middle"===a.baseline?".35em":0;this.setAttribute("x",b+d),this.setAttribute("y",c+e),this.setAttribute("dy",e),this.setAttribute("text-anchor",g),f?this.setAttribute("transform","rotate("+f+" "+b+","+c+")"):this.removeAttribute("transform"),h?this.setAttribute("dy",h):this.removeAttribute("dy"),this.textContent=a.text,this.style.setProperty("font",p(a),null)}function r(a){var b=a.x||0,c=a.y||0;if(this.setAttribute("transform","translate("+b+","+c+")"),a.clip){var d={width:a.width||0,height:a.height||0},e=a.clip_id||(a.clip_id="clip"+B++);K.svg._cur._defs.clipping[e]=d,this.setAttribute("clip-path","url(#"+e+")")}}function s(a){var b=a.width||0,c=a.height||0;this.setAttribute("width",b),this.setAttribute("height",c)}function t(a,b,c){return function(d,e,f){u(d,e,f,"mark_",a,b,c)}}function u(b,c,d,e,f,h,i){var j=i?[c.items]:c.items,k=c.interactive===!1?"none":null,l=b.node().childNodes,m="g"!==f,n=(n=l[d+1])?a.select(n):b.append("g").attr("id","g"+ ++A),o=n.attr("id"),p="#"+o+" > "+f,q=n.selectAll(p).data(j),r=q.enter().append(f);return m?(n.style("pointer-events",k),r.each(function(a){a.mark?a._svg=this:a.length&&(a[0]._svg=this)})):r.append("rect").attr("class","background").style("pointer-events",k),q.exit().remove(),q.each(h),m?q.each(g):n.selectAll(p+" > rect.background").each(s).each(g),n}function v(b,c,d,e){var f,g,h,i=u(b,c,d,e||"group_","g",r),j=i.node().childNodes,k=j.length;for(f=0;k>f;++f){var l=j[f].__data__.items,m=j[f].__data__.legendItems||[],n=j[f].__data__.axisItems||[],o=a.select(j[f]),p=0;for(g=0,h=n.length;h>g;++g)"back"===n[g].def.layer&&v.call(this,o,n[g],p++,"axis_");for(g=0,h=l.length;h>g;++g)this.draw(o,l[g],p++);for(g=0,h=n.length;h>g;++g)"back"!==n[g].def.layer&&v.call(this,o,n[g],p++,"axis_");for(g=0,h=m.length;h>g;++g)v.call(this,o,m[g],p++,"legend_")}}var w=a.svg.arc(),x=a.svg.area().x(b).y1(c).y0(d),y=a.svg.line().x(b).y(c),z=a.svg.symbol().type(f).size(e),A=0,B=0,C={left:"start",center:"middle",right:"end"},D={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},E=K.keys(D);return{update:{group:l,area:i,line:j,arc:h,path:k,symbol:n,rect:l,rule:m,text:q,image:o},nested:{area:!0,line:!0},style:g,draw:{group:v,area:t("path",i,!0),line:t("path",j,!0),arc:t("path",h),path:t("path",k),symbol:t("path",n),rect:t("rect",l),rule:t("line",m),text:t("text",q),image:t("image",o),draw:t}}}(),K.svg.Renderer=function(){var b=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},c=b.prototype;return c.initialize=function(b,c,d,e){return this._el=b,a.select(b).select("svg.marks").remove(),this._svg=a.select(b).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(c,d,e)},c.resize=function(a,b,c){return this._width=a,this._height=b,this._padding=c,this._svg.attr("width",a+c.left+c.right).attr("height",b+c.top+c.bottom),this._ctx.attr("transform","translate("+c.left+","+c.top+")"),this},c.context=function(){return this._ctx},c.element=function(){return this._el},c.updateDefs=function(){var b,c,d=this._svg,e=this._defs,f=K.keys(e.gradient),g=K.keys(e.clipping),h=d.select("defs");return 0===f.length&&0==g.length?(h.remove(),void 0):(h.empty()&&(h=d.insert("defs",":first-child")),b=h.selectAll("linearGradient").data(f,K.identity),b.enter().append("linearGradient").attr("id",K.identity),b.exit().remove(),b.each(function(b){var c=e.gradient[b],d=a.select(this);d.attr({x1:c.x1,x2:c.x2,y1:c.y1,y2:c.y2}),stop=d.selectAll("stop").data(c.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(a){return a.offset}).attr("stop-color",function(a){return a.color})}),c=h.selectAll("clipPath").data(g,K.identity),c.enter().append("clipPath").attr("id",K.identity),c.exit().remove(),c.each(function(b){var c=e.clipping[b],d=a.select(this).selectAll("rect").data([1]);d.enter().append("rect"),d.attr("x",0).attr("y",0).attr("width",c.width).attr("height",c.height)}),void 0)},c.render=function(a,b){K.svg._cur=this,b?this.renderItems(K.array(b)):this.draw(this._ctx,a,-1),this.updateDefs(),delete K.svg._cur},c.renderItems=function(a){var b,c,d,e,f,g=K.svg.marks;for(e=0,f=a.length;f>e;++e)b=a[e],c=b._svg,d=b.mark.marktype,b=g.nested[d]?b.mark.items:b,g.update[d].call(c,b),g.style.call(c,b)},c.draw=function(a,b,c){var d=b.marktype,e=K.svg.marks.draw[d];e.call(this,a,b,c)},b}(),K.svg.Handler=function(){function b(a){var b=this;return function(c){var d=c.target,e=d.__data__;e&&(e=e.mark?e:e[0],a.call(b._obj,c,e))}}function c(a){var b=a.indexOf(".");return 0>b?a:a.slice(0,b)}var d=function(a,b){this._active=null,this._handlers={},a&&this.initialize(a),b&&this.model(b)},e=d.prototype;return e.initialize=function(b,c,d){return this._el=a.select(b).node(),this._svg=a.select(b).select("svg.marks").node(),this._padding=c,this._obj=d||null,this},e.padding=function(a){return this._padding=a,this},e.model=function(a){return arguments.length?(this._model=a,this):this._model},e.handlers=function(){var a=this._handlers;return K.keys(a).reduce(function(b,c){return a[c].reduce(function(a,b){return a.push(b),a},b)},[])},e.on=function(d,e){var f=c(d),g=this._handlers,h=a.select(this._svg).node(),i={type:d,handler:e,svg:b.call(this,e)};return g=g[f]||(g[f]=[]),g.push(i),h.addEventListener(f,i.svg),this},e.off=function(b,d){var e=c(b),f=this._handlers[e],g=a.select(this._svg).node();if(f){for(var h=f.length;--h>=0;)f[h].type===b&&(d&&f[h].handler!==d||(g.removeEventListener(e,f[h].svg),f.splice(h,1)));return this}},d}(),K.data={},K.data.ingestAll=function(a){return K.isTree(a)?f(K.data.ingestTree(a[0],a.children)):a.map(K.data.ingest)},K.data.ingest=function(a,b){return{data:a,index:b}},K.data.ingestTree=function(a,b,c){var d,e,f=K.data.ingest(a,c||0),g=a[b];if(g&&(d=g.length))for(f.values=Array(d),e=0;d>e;++e)f.values[e]=K.data.ingestTree(g[e],b,e);return f},K.data.mapper=function(a){return function(b){return b.forEach(a),b}},K.data.size=function(a,b){return a=K.isArray(a)?a:[0,a],a=a.map(function(a){return"string"==typeof a?b[a]:a})},K.data.load=function(a,b){var c=i(a)?a:K.config.baseURL+a;if(K.config.isNode){var d=j(c)?m:n;d(c,b)}else k(c,b)};var P=/^[A-Za-z]+\:\/\//,Q="file://";K.data.read=function(){function c(a,b){var c=b&&b.type||"json";return a=f[c](a,b),b&&b.parse&&d(a,b.parse),a}function d(a,b){var c=K.keys(b),d=c.map(function(a){return g[b[a]]}),f=K.isTree(a);e(f?[a]:a,c,d,f)}function e(a,b,c,e){var f,g,h,i,j;for(g=0,i=a.length;i>g;++g){for(f=a[g],h=0,j=b.length;j>h;++h)f[b[h]]=c[h](f[b[h]]);e&&f.values&&d(f,b,c,!0)}}var f={},g={number:K.number,"boolean":K.boolean,date:Date.parse};return f.json=function(a,b){var c=K.isObject(a)?a:JSON.parse(a);return b&&b.property&&(c=K.accessor(b.property)(c)),c},f.csv=function(b){var c=a.csv.parse(b);return c},f.tsv=function(b){var c=a.tsv.parse(b);return c},f.topojson=function(a,c){if(null==b)return K.error("TopoJSON library not loaded."),[];var d=K.isObject(a)?a:JSON.parse(a),e=[];return c&&c.feature?e=(e=d.objects[c.feature])?b.feature(d,e).features:(K.error("Invalid TopoJSON object: "+c.feature),[]):c&&c.mesh?e=(e=d.objects[c.mesh])?[b.mesh(d,d.objects[c.mesh])]:(K.error("Invalid TopoJSON object: "+c.mesh),[]):K.error("Missing TopoJSON feature or mesh parameter."),e},f.treejson=function(a,b){return a=K.isObject(a)?a:JSON.parse(a),K.tree(a,b.children)},c.formats=f,c.parse=d,c}(),K.data.array=function(){function a(a){return a.map(function(a){for(var c=[],d=0,e=b.length;e>d;++d)c.push(b[d](a));return c})}var b=[];return a.fields=function(c){return b=K.array(c).map(K.accessor),a},a},K.data.copy=function(){var a=K.accessor("data"),b=[],c=null,d=K.data.mapper(function(d){var e,f,g=a(d),h=c||b;for(e=0,f=b.length;f>e;++e)d[h[e]]=g[b[e]];return d});return d.from=function(b){return a=K.accessor(b),d},d.fields=function(a){return b=K.array(a),d},d.as=function(a){return c=K.array(a),d},d},K.data.cross=function(){function a(a){var e,f,g,h=[],i=b||a,j=a.length;for(f=0;j>f;++f)for(g=0;j>g;++g)c&&f===g||(e={},e[d.left]=a[f],e[d.right]=i[g],h.push(e));return h}var b=null,c=!1,d={left:"a",right:"b"};return a["with"]=function(c){return b=c,a},a.diagonal=function(b){return c=!b,a},a.output=function(b){return K.keys(d).forEach(function(a){void 0!==b[a]&&(d[a]=b[a])}),a},a},K.data.facet=function(){function a(a){var d,e,f,g,h,i,j,k={key:"",keys:[],values:[]},l={},m=k.values;if(0===b.length)return m.push(d={key:"",keys:[],index:0,values:c?a.slice():a}),c&&c(d.values),k;for(h=0,g=a.length;g>h;++h){for(i=0,e=[],f="";i<b.length;++i)j=b[i](a[h]),e.push(j),f+=(i>0?"|":"")+String(j);d=l[f],void 0===d&&m.push(d=l[f]={key:f,keys:e,index:m.length,values:[]}),d.values.push(a[h])}if(c)for(h=0,g=m.length;g>h;++h)c(m[h].values);return k}var b=[],c=null;return a.keys=function(c){return b=K.array(c).map(K.accessor),a},a.sort=function(b){return c=K.data.sort().by(b),a},a},K.data.filter=function(){function a(a){return b?a.filter(b):a}var b=null;return a.test=function(c){return b=K.isFunction(c)?c:K.parse.expr(c),a},a},K.data.flatten=function(){function a(a){return b(a,[])}function b(a,c){if(a.values)for(var d=0,e=a.values.length;e>d;++d)b(a.values[d],c);else c.push(a);return c}return a},K.data.fold=function(){function a(a){var e,f,g,h,i=[],j=b.length;for(f=0,h=a.length;h>f;++f)for(e=a[f],g=0;j>g;++g){var k={index:i.length,data:e.data};k[d.key]=b[g],k[d.value]=c[g](e),i.push(k)}return i}var b=[],c=[],d={key:"key",value:"value"};return a.fields=function(d){return b=K.array(d),c=b.map(K.accessor),a},a.output=function(b){return K.keys(d).forEach(function(a){void 0!==b[a]&&(d[a]=b[a])}),a},a},K.data.force=function(){function b(a,b,e){c.size(K.data.size(i,e)).nodes(a),d&&b[d]&&c.links(b[d]),c.start();for(var f=0;h>f;++f)c.tick();return c.stop(),a}var c=a.layout.force(),d=null,e=20,f=1,g=-30,h=500,i=["width","height"],j=["friction","theta","gravity","alpha"];return b.links=function(a){return d=a,b},b.size=function(a){return i=a,b},b.linkDistance=function(a){return e="number"==typeof a?a:K.accessor(a),c.linkDistance(e),b},b.linkStrength=function(a){return f="number"==typeof a?a:K.accessor(a),c.linkStrength(f),b},b.charge=function(a){return g="number"==typeof a?a:K.accessor(a),c.charge(g),b},b.iterations=function(a){return h=a,b},j.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b},K.data.formula=function(){return function(){var a=null,b=K.identity,c=K.data.mapper(function(c,d,e){return a&&(c[a]=b.call(null,c,d,e)),c});return c.field=function(b){return a=b,c},c.expr=function(a){return b=K.isFunction(a)?a:K.parse.expr(a),c},c}}(),K.data.geo=function(){function b(){var b={},d="mercator",e=a.geo[d](),f=K.identity,g=K.identity,h={x:"x",y:"y"},i=K.data.mapper(function(a){var b=[g(a),f(a)],c=e(b);return a[h.x]=c[0],a[h.y]=c[1],a});return i.func=function(){return e},i.projection=function(c){if(d!==c){d=c,e=a.geo[d]();for(var f in b)e[f](b[f])}return i},c.forEach(function(a){i[a]=function(c){return b[a]=c,e[a](c),i}}),i.lon=function(a){return g=K.accessor(a),i},i.lat=function(a){return f=K.accessor(a),i},i.output=function(a){return K.keys(h).forEach(function(b){void 0!==a[b]&&(h[b]=a[b])}),a},i}var c=["center","scale","translate","rotate","precision","clipAngle"];return b.params=c,b}(),K.data.geopath=function(){var b=a.geo.path().projection(a.geo.mercator()),c="mercator",d=K.identity,e={},f={path:"path"},g=K.data.mapper(function(a){return a[f.path]=b(d(a)),a});return g.projection=function(d){if(c!==d){c=d;var f=a.geo[c]();for(var h in e)f[h](e[h]);b.projection(f)}return g},K.data.geo.params.forEach(function(a){g[a]=function(c){return e[a]=c,b.projection()[a](c),g}}),g.value=function(a){return d=K.accessor(a),g},g.output=function(a){return K.keys(f).forEach(function(b){void 0!==a[b]&&(f[b]=a[b])}),a},g},K.data.link=function(){function a(a){var b=g(a),c=h(a);return"M"+b.x+","+b.y+"L"+c.x+","+c.y}function b(a){var b=g(a),c=h(a),d=c.x-b.x,e=c.y-b.y,f=i*(d+e),j=i*(e-d);return"M"+b.x+","+b.y+"C"+(b.x+f)+","+(b.y+j)+" "+(c.x+j)+","+(c.y-f)+" "+c.x+","+c.y}function c(a){var b=g(a),c=h(a),d=(b.x+c.x)/2;return"M"+b.x+","+b.y+"C"+d+","+b.y+" "+d+","+c.y+" "+c.x+","+c.y}function d(a){var b=g(a),c=h(a),d=(b.y+c.y)/2;return"M"+b.x+","+b.y+"C"+b.x+","+d+" "+c.x+","+d+" "+c.x+","+c.y}function e(a){var b=k[f];return a.forEach(function(a){a[j.path]=b(a)}),a}var f="line",g=K.accessor("source"),h=K.accessor("target"),i=.2,j={path:"path"},k={line:a,curve:b,diagonal:c,diagonalX:c,diagonalY:d};return e.shape=function(a){return f=a,e},e.tension=function(a){return i=a,e},e.source=function(a){return g=K.accessor(a),e},e.target=function(a){return h=K.accessor(a),e},e.output=function(a){return K.keys(j).forEach(function(b){void 0!==a[b]&&(j[b]=a[b])}),e},e},K.data.pie=function(){function b(b){var c=b.map(function(a){return+d(a)}),i=e,j=(f-e)/a.sum(c),k=a.range(b.length);return g&&k.sort(function(a,b){return c[a]-c[b]}),k.forEach(function(a){var d;b[a].value=d=c[a],b[a][h.startAngle]=i,b[a][h.endAngle]=i+=d*j}),b}var c=function(){return 1},d=c,e=0,f=2*Math.PI,g=!1,h={startAngle:"startAngle",endAngle:"endAngle"};return b.sort=function(a){return g=a,b},b.value=function(a){return d=a?K.accessor(a):c,b},b.startAngle=function(a){return e=Math.PI*a/180,b},b.endAngle=function(a){return f=Math.PI*a/180,b},b.output=function(a){return K.keys(h).forEach(function(b){void 0!==a[b]&&(h[b]=a[b])}),b},b},K.data.slice=function(){function a(a){if(a=K.values(a),"min"===b)a=[a[K.minIndex(a,c)]];else if("max"===b)a=[a[K.maxIndex(a,c)]];else if("median"===b){var d=a.slice().sort(function(a,b){return a=c(a),b=c(b),b>a?-1:a>b?1:0});a=[a[~~(d.length/2)]]}else{var e=K.array(b);a=a.slice(e[0],e[1])}return a}var b=null,c=K.accessor("data");return a.by=function(c){return b=c,a},a.field=function(b){return c=K.accessor(b),a},a},K.data.sort=function(){function a(a){a=K.isArray(a)?a:a.values||[],a.sort(b);for(var c=0,d=a.length;d>c;++c)a[c].index=c;return a}var b=null;return a.by=function(c){return b=K.comparator(c),a},a},K.data.stack=function(){function b(a){var b=h.y0,e=h.y1,f=h.cy,g=c(a);return 0===g.length?a:(d.out(function(a,c,d){a.datum&&(a.datum[b]=c,a.datum[e]=d+c,a.datum[f]=c+d/2)})(g),a)}function c(a){var b,c,d,g,h,i,j,k,l=K.values(a),m=[],n=[];if(0===l.length)return n;for(c=0,d=l.length;d>c;++c){for(b=K.values(l[c]),g=0,h=b.length;h>g;++g)m.push({x:e(b[g]),y:f(b[g]),z:c,datum:b[g]});n.push([])}for(m.sort(function(a,b){return a.x<b.x?-1:a.x>b.x?1:a.z<b.z?-1:a.z>b.z?1:0}),k=m[0].x,c=0,g=0,i=0,d=m.length;d>i;++i){if(j=m[i],j.x!==k){for(;c<n.length;)n[c++].push({x:g,y:0});k=j.x,c=0,g+=1}for(;j.z>c;)n[c++].push({x:g,y:0});j.x=g,n[c++].push(j)}for(;c<n.length;)n[c++].push({x:g,y:0});return n}var d=a.layout.stack(),e=K.accessor("index"),f=K.accessor("data"),g=["offset","order"],h={y0:"y2",y1:"y",cy:"cy"};return b.point=function(a){return e=K.accessor(a),b},b.height=function(a){return f=K.accessor(a),b},g.forEach(function(a){b[a]=function(c){return d[a](c),b}}),b.output=function(c){return a.keys(h).forEach(function(a){void 0!==c[a]&&(h[a]=c[a])}),b},b},K.data.stats=function(){function a(a){var b,g,h,i,j=+1/0,k=-1/0,l=0,m=0,n=0,o=(K.isArray(a)?a:a.values||[]).map(c);for(b=0,g=o.length;g>b;++b)h=o[b],j>h&&(j=h),h>k&&(k=h),l+=h,i=h-m,m+=i/(b+1),n+=i*(h-m);n/=g-1;var p=K.isArray(a)?{}:a;if(e&&(o.sort(K.numcmp),b=o.length>>1,p[f.median]=o.length%2?o[b]:(o[b-1]+o[b])/2),p[f.count]=g,p[f.min]=j,p[f.max]=k,p[f.sum]=l,p[f.mean]=m,p[f.variance]=n,p[f.stdev]=Math.sqrt(n),d)for(o=K.isArray(a)?a:a.values,h={},h[f.count]=g,h[f.min]=j,h[f.max]=k,h[f.sum]=l,h[f.mean]=m,h[f.variance]=n,h[f.stdev]=Math.sqrt(n),e&&(h[f.median]=p[f.median]),b=0,g=o.length;g>b;++b)o[b].stats=h;return p}function b(b){return(K.isArray(b)?[b]:b.values||[]).map(a)}var c=K.accessor("data"),d=!1,e=!1,f={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return b.median=function(a){return e=a||!1,b},b.value=function(a){return c=K.accessor(a),b},b.assign=function(a){return d=a,b},b.output=function(a){return K.keys(f).forEach(function(b){void 0!==a[b]&&(f[b]=a[b])}),b},b},K.data.treemap=function(){function b(a,b,f){a=c.size(K.data.size(e,f)).value(d).nodes(K.isTree(a)?a:{values:a});var h=K.keys(g),i=h.length;return a.forEach(function(a){for(var b,c,d=0;i>d;++d)b=h[d],b!==g[b]&&(c=a[b],delete a[b],a[g[b]]=c)}),a}var c=a.layout.treemap().children(function(a){return a.values}),d=K.accessor("data"),e=["width","height"],f=["round","sticky","ratio","padding"],g={x:"x",y:"y",dx:"width",dy:"height"};return b.size=function(a){return e=a,b},b.value=function(a){return d=K.accessor(a),b},f.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b.output=function(a){return K.keys(g).forEach(function(b){void 0!==a[b]&&(g[b]=a[b])}),b},b},K.data.truncate=function(){var a=K.accessor("data"),b="truncate",c="right",d="...",e=!0,f=100,g=K.data.mapper(function(g){var h=K.truncate(a(g),f,c,e,d);return g[b]=h,g});return g.value=function(b){return a=K.accessor(b),g},g.output=function(a){return b=a,g},g.limit=function(a){return f=+a,g},g.position=function(a){return c=a,g},g.ellipsis=function(a){return d=a+"",g},g.wordbreak=function(a){return e=!!a,g},g},K.data.unique=function(){function a(a){return K.unique(a,b).map(function(a){var b={};return b[c]=a,b})}var b=null,c="field";return a.field=function(c){return b=K.accessor(c),a},a.as=function(b){return c=b,a},a},K.data.window=function(){function a(a){a=K.isArray(a)?a:a.values||[];var d,e,f,g=[],h=a.length-b;for(d=0;h>=d;d+=c){for(e=0,f=[];b>e;++e)f.push(a[d+e]);g.push({key:d,values:f})}return{values:g}}var b=2,c=1;return a.size=function(c){return b=c,a},a.step=function(b){return c=b,a},a},K.data.wordcloud=function(){function b(a,b,h){function j(b){var d,e,g,h,j,k=c.size(),l=k[0]/2,m=k[1]/2,n=K.keys(i),o=n.length;for(a.sort(function(a,b){return f(b)-f(a)}),g=0,h=b.length;h>g;++g)for(e=a[g],j=0;o>j;++j)d=n[j],e[i[d]]=b[g][d],"x"===d&&(e[i.x]+=l),"y"===d&&(e[i.y]+=m)}return c.size(K.data.size(e,h)).text(d).fontSize(f).rotate(g).words(a).on("end",j).start(),a}var c=a.layout.cloud().size([900,500]),d=K.accessor("data"),e=["width","height"],f=function(){return 14},g=function(){return 0},h=["font","fontStyle","fontWeight","padding"],i={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return b.text=function(a){return d=K.accessor(a),b},b.size=function(a){return e=a,b},b.fontSize=function(a){return f=K.accessor(a),b},b.rotate=function(a){var c;return K.isObject(a)&&!Array.isArray(a)?void 0!==a.random?(c=(c=a.random)?K.array(c):[0],g=function(){return c[~~(Math.random()*c.length-1e-5)]}):void 0!==a.alternate&&(c=(c=a.alternate)?K.array(c):[0],g=function(a,b){return c[b%c.length]}):g=K.accessor(field),b},h.forEach(function(a){b[a]=function(d){return c[a](d),b}}),b.output=function(a){return K.keys(i).forEach(function(b){void 0!==a[b]&&(i[b]=a[b])}),b},b},K.data.zip=function(){function a(a,g){var h,i,j,k,l,m=g[b],n=m.length;for(f&&(l={},m.forEach(function(a){l[f(a)]=a})),j=0,k=a.length;k>j;++j)i=a[j],i[c]=l?null!=(h=l[d(i)])?h:e:m[j%n];return a}var b=null,c="zip",d=K.accessor("data"),e=void 0,f=null;return a["with"]=function(c){return b=c,a},a["default"]=function(b){return e=b,a},a.as=function(b){return c=b,a},a.key=function(b){return d=K.accessor(b),a},a.withKey=function(b){return f=K.accessor(b),a},a},K.parse={},K.parse.axes=function(){function b(a,b,d){(a||[]).forEach(function(a,e){b[e]=b[e]||K.scene.axis(),c(a,e,b[e],d)})}function c(b,c,e,f){void 0!==b.scale&&e.scale(f[b.scale]),e.orient(b.orient||d[b.type]),e.offset(b.offset||0),e.layer(b.layer||"front"),e.grid(b.grid||!1),e.title(b.title||null),e.titleOffset(null!=b.titleOffset?b.titleOffset:K.config.axis.titleOffset),e.tickValues(b.values||null),e.tickFormat(b.format?a.format(b.format):null),e.tickSubdivide(b.subdivide||0),e.tickPadding(b.tickPadding||K.config.axis.padding);var g=[];if(void 0!==b.tickSize)for(var h=0;3>h;++h)g.push(b.tickSize);else{var i=K.config.axis.tickSize;g=[i,i,i]}if(null!=b.tickSizeMajor&&(g[0]=b.tickSizeMajor),null!=b.tickSizeMinor&&(g[1]=b.tickSizeMinor),null!=b.tickSizeEnd&&(g[2]=b.tickSizeEnd),g.length&&e.tickSize.apply(e,g),null!=b.ticks){var j=K.isArray(b.ticks)?b.ticks:[b.ticks];e.ticks.apply(e,j)}else e.ticks(K.config.axis.ticks);var k=b.properties;k&&k.ticks?(e.majorTickProperties(k.majorTicks?K.extend({},k.ticks,k.majorTicks):k.ticks),e.minorTickProperties(k.minorTicks?K.extend({},k.ticks,k.minorTicks):k.ticks)):(e.majorTickProperties(k&&k.majorTicks||{}),e.minorTickProperties(k&&k.minorTicks||{})),e.tickLabelProperties(k&&k.labels||{}),e.titleProperties(k&&k.title||{}),e.gridLineProperties(k&&k.grid||{}),e.domainProperties(k&&k.axis||{})}var d={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return b}(),K.parse.data=function(a,b){function c(a){return function(c,f){c?K.error("LOADING FAILED: "+a.url):d.load[a.name]=K.data.read(f.toString(),a.format),0===--e&&b()}}var d={defs:a,load:{},flow:{},source:{}},e=0;return(a||[]).forEach(function(a){if(a.url)e+=1,K.data.load(a.url,c(a));else if(a.values)d.load[a.name]=K.data.read(a.values,a.format);else if(a.source){var b=d.source[a.source]||(d.source[a.source]=[]);b.push(a.name)}a.transform&&(d.flow[a.name]=K.parse.dataflow(a))}),0===e&&setTimeout(b,1),d},K.parse.dataflow=function(a){var b=(a.transform||[]).map(K.parse.transform),c=b.length?function(a,c,d){return b.reduce(function(a,b){return b(a,c,d)},a)}:K.identity;return c.transforms=b,c},K.parse.expr=function(){var a={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},b={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan"},c=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return function(d){var e,f,g,h,i,j,k=d.split(c);for(i=0,j=0,g=0,h=k.length;h>g;++g){var e=k[g];"'"!==e?'"'!==e?j||i||(a[e]&&(k[g]=a[e]),b[e]&&(f=k[g+1])&&"("===f[0]&&(k[g]=b[e])):i||(j=!j):j||(i=!i)}return Function("d","index","data","return ("+k.join("")+");")}}(),K.parse.legends=function(){function b(a,b,d){(a||[]).forEach(function(a,e){b[e]=b[e]||K.scene.legend(),c(a,e,b[e],d)})}function c(b,c,d,e){d.size(b.size?e[b.size]:null),d.shape(b.shape?e[b.shape]:null),d.fill(b.fill?e[b.fill]:null),d.stroke(b.stroke?e[b.stroke]:null),b.orient&&d.orient(b.orient),null!=b.offset&&d.offset(b.offset),d.title(b.title||null),d.values(b.values||null),d.format(void 0!==b.format?a.format(b.format):null);var f=b.properties;d.titleProperties(f&&f.title||{}),d.labelProperties(f&&f.labels||{}),d.legendProperties(f&&f.legend||{}),d.symbolProperties(f&&f.symbols||{}),d.gradientProperties(f&&f.gradient||{})}return b}(),K.parse.mark=function(a){var b=a.properties,c=a.marks;if(K.keys(b).forEach(function(c){b[c]=K.parse.properties(a.type,b[c])}),a.delay&&(a.delay=K.parse.properties(a.type,{delay:a.delay})),a.from){var d=a.from.data,e=K.parse.dataflow(a.from);a.from=function(a,b,c){var f=K.scene.data(d?a[d]:null,c);return e(f,a,b)}}return c&&(a.marks=c.map(K.parse.mark)),a},K.parse.marks=function(a,b,c){return{type:"group",width:b,height:c,scales:a.scales||[],axes:a.axes||[],legends:a.legends||[],marks:(a.marks||[]).map(K.parse.mark)}},K.parse.padding=function(a){if(null==a)return"auto";if(K.isString(a))return"strict"===a?"strict":"auto";if(K.isObject(a))return a;var b=K.isNumber(a)?a:20;return{top:b,left:b,right:b,bottom:b}},K.parse.properties=function(){function a(a,d){var e,f,g,h,i="",j=K.keys(d),k={};for(i+="var o = trans ? {} : item;\n",e=0,f=j.length;f>e;++e)h=d[g=j[e]],i+=e>0?"\n  ":"  ",i+="o."+g+" = "+c(g,h)+";",k[g]=!0;k.x2&&(k.x?(i+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",i+="\n  o.width = (o.x2 - o.x);"):i+=k.width?"\n  o.x = (o.x2 - o.width);":"\n  o.x = o.x2;"),k.y2&&(k.y?(i+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",i+="\n  o.height = (o.y2 - o.y);"):i+=k.height?"\n  o.y = (o.y2 - o.height);":"\n  o.y = o.y2;"),b(a,k)&&(i+="\n  item.touch();"),i+="\n  if (trans) trans.interpolate(item, o);";try{return Function("item","group","trans",i)}catch(l){K.error(l),K.log(i)}}function b(a,b){return b.path||("area"===a||"line"===a)&&(b.x||b.x2||b.width||b.y||b.y2||b.height||b.tension||b.interpolate)}function c(a,b){if(null==b)return null;var c="fill"===a||"stroke"===a;if(c){if(b.c)return d("hcl",b.h,b.c,b.l);if(b.h||b.s)return d("hsl",b.h,b.s,b.l);if(b.l||b.a)return d("lab",b.l,b.a,b.b);if(b.r||b.g||b.b)return d("rgb",b.r,b.g,b.b)}var f="item.datum.data";if(void 0!==b.value&&(f=K.str(b.value)),null!=b.group){var g="group.datum";K.isString(b.group)&&(g=e[b.group]?"group."+b.group:"group.datum["+K.field(b.group).map(K.str).join("][")+"]")}if(null!=b.field?K.isString(b.field)?(f="item.datum["+K.field(b.field).map(K.str).join("][")+"]",null!=b.group&&(f="this.accessor("+f+")("+g+")")):f="this.accessor(group.datum["+K.field(b.field.group).map(K.str).join("][")+"])(item.datum.data)":null!=b.group&&(f=g),null!=b.scale){var h=K.isString(b.scale)?K.str(b.scale):(b.scale.group?"group":"item")+".datum["+K.str(b.scale.group||b.scale.field)+"]";h="group.scales["+h+"]",f=h+(b.band?".rangeBand()":"("+f+")")}return f="("+(b.mult?K.number(b.mult)+" * ":"")+f+")"+(b.offset?" + "+K.number(b.offset):"")}function d(a,b,d,e){var f=b?c("",b):K.config.color[a][0],g=d?c("",d):K.config.color[a][1],h=e?c("",e):K.config.color[a][2];return"(this.d3."+a+"("+[f,g,h].join(",")+') + "")'}var e={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return a}(),K.parse.scales=function(){function b(a,b,d,e){return(a||[]).reduce(function(a,b){var f=b.name,g=f+":prev";return a[f]=c(b,a[f],d,e),a[g]=a[g]||a[f],a},b||{})}function c(a,b,c,h){var j=d(a,b),k=j.type===i?e:f,l=g(a,h),m=K.values(h.datum);return k(a,j,l,c,m),j}function d(b,c){var d=b.type||h;if(!c||d!==c.type){var e=K.config.scale[d]||a.scale[d];e||K.error("Unrecognized scale type: "+d),(c=e()).type=c.type||d,c.scaleName=b.name}return c}function e(a,b,c,d,e){var f,g,h,i;f=a.domain,K.isArray(f)?b.domain(f):K.isObject(f)&&(g=a.domain.fields||K.array(a.domain),h=g.reduce(function(a,b){var c=K.values(d[b.data]||e),f=K.accessor(K.isString(b.field)?b.field:"data."+K.accessor(b.field.group)(e));return K.unique(c,f,a)},[]),a.sort&&h.sort(K.cmp),b.domain(h)),i="string"==typeof c[0],i||c.length>2?b.range(c):a.points?b.rangePoints(c,a.padding||0):a.round||void 0===a.round?b.rangeRoundBands(c,a.padding||0):b.rangeBands(c,a.padding||0)}function f(b,c,d,e,f){function g(b,c,d,g){var i=K.values(e[b.data]||f),j=K.array(b.field).map(function(a){return K.isString(a)?a:"data."+K.accessor(a.group)(f)});j.forEach(function(b){b=K.accessor(b),c&&(h[0]=a.min([h[0],a.min(i,b)])),d&&(h[g]=a.max([h[g],a.max(i,b)]))})}var h,i,m,n;h=[null,null],void 0!==b.domain&&(K.isArray(b.domain)?h=b.domain.slice():K.isObject(b.domain)?(i=b.domain.fields||K.array(b.domain),i.forEach(function(a){g(a,1,1,1)})):h=b.domain),n=h.length-1,void 0!==b.domainMin&&(K.isObject(b.domainMin)?(h[0]=null,i=b.domainMin.fields||K.array(b.domainMin),i.forEach(function(a){g(a,1,0,n)})):h[0]=b.domainMin),void 0!==b.domainMax&&(K.isObject(b.domainMax)?(h[n]=null,i=b.domainMax.fields||K.array(b.domainMax),i.forEach(function(a){g(a,0,1,n)})):h[n]=b.domainMax),b.type===j||b.type===l||!b.zero&&void 0!==b.zero||(h[0]=Math.min(0,h[0]),h[n]=Math.max(0,h[n])),c.domain(h),"height"===b.range&&(d=d.reverse()),c[b.round&&c.rangeRound?"rangeRound":"range"](d),b.exponent&&b.type===k&&c.exponent(b.exponent),b.clamp&&c.clamp(!0),b.nice&&(b.type===l?(m=a.time[b.nice],m||K.error("Unrecognized interval: "+m),c.nice(m)):c.nice())}function g(a,b){var c=[null,null];if(void 0!==a.range)if("string"==typeof a.range)if(m[a.range])c=[0,b[a.range]];else{if(!K.config.range[a.range])return K.error("Unrecogized range: "+a.range),c;c=K.config.range[a.range]}else c=K.isArray(a.range)?a.range:[0,a.range];if(void 0!==a.rangeMin&&(c[0]=a.rangeMin),void 0!==a.rangeMax&&(c[c.length-1]=a.rangeMax),void 0!==a.reverse){var d=a.reverse;K.isObject(d)&&(d=K.accessor(d.field)(b.datum)),d&&(c=c.reverse())}return c}var h="linear",i="ordinal",j="log",k="pow",l="time",m={width:1,height:1};return b}(),K.parse.spec=function(b,c,d){function e(a){a=K.duplicate(a);var b=a.width||500,e=a.height||500,f=a.viewport||null,g={width:b,height:e,viewport:f,padding:K.parse.padding(a.padding),marks:K.parse.marks(a,b,e),data:K.parse.data(a.data,function(){c(h)})},h=d(g)}d=d||K.ViewFactory,K.isObject(b)?e(b):a.json(b,function(a,b){a?K.error(a):e(b)})},K.parse.transform=function(a){var b=K.data[a.type]();return K.keys(a).forEach(function(c){"type"!==c&&b[c](a[c])}),b},K.scene={},K.scene.GROUP="group",K.scene.ENTER=0,K.scene.UPDATE=1,K.scene.EXIT=2,K.scene.DEFAULT_DATA={sentinel:1},K.scene.data=function(a,b){var c=K.scene.DEFAULT_DATA;return a=K.values(a||b||[c]),a===c&&(a=[c]),a},K.scene.fontString=function(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:K.config.render.fontSize)+"px "+(a.font||K.config.render.font)},K.scene.Item=function(){function a(a){this.mark=a}var b=a.prototype;return b.hasPropertySet=function(a){var b=this.mark.def.properties;return b&&null!=b[a]},b.cousin=function(a,b){if(0===a)return this;a=a||-1;var c=this.mark,d=c.group,e=null==b?c.items.indexOf(this):b,f=d.items.indexOf(c)+a;return d.items[f].items[e]},b.sibling=function(a){if(0===a)return this;a=a||-1;var b=this.mark,c=b.items.indexOf(this)+a;return b.items[c]},b.remove=function(){var a=this,b=a.mark.items,c=b.indexOf(a);return c>=0&&(c===b.length-1?b.pop():b.splice(c,1)),a
},b.touch=function(){this.cache&&(this.cache=null),this.mark.cache&&(this.mark.cache=null)},a}(),K.scene.item=function(a){return new K.scene.Item(a)},K.scene.visit=function(a,b){var c,d,e;if(b(a))return!0;if(e=a.items)for(c=0,d=e.length;d>c;++c)if(K.scene.visit(e[c],b))return!0},K.scene.build=function(){function b(a,b,g,i){var j=K.scene.data(a.from?a.from(b,g,i):null,i);return g=c(a,g),g.items=d(a,j,g),f(a,g),a.type===h&&e(a,b,g),g}function c(a,b){return b=b||{},b.def=a,b.marktype=a.type,b.interactive=!(a.interactive===!1),b}function d(a,b,c){var d,e,f,h,l,m,n=g(a.key),o=c.items||[],p=[],q={};for(d=0,f=o.length;f>d;++d)h=o[d],h.status=k,n&&(q[h.key]=h);for(d=0,f=b.length;f>d;++d)l=b[d],e=d,h=n?q[e=n(l)]:o[d],m=h?!1:(h=K.scene.item(c),!0),h.status=m?i:j,h.datum=l,h.key=e,p.push(h);for(d=0,f=o.length;f>d;++d)h=o[d],h.status===k&&(h.key=n?h.key:p.length,p.push(h));return p}function e(a,c,d){var e,f,g,h,i,j,k=d.items,l=a.marks;for(e=0,f=k.length;f>e;++e){if(j=k[e],j.scales)for(i in j.scales)i.indexOf(":prev")<0&&(j.scales[i+":prev"]=j.scales[i].copy());for(j.items=j.items||[],g=0,h=l.length;h>g;++g)j.items[g]=b(l[g],c,j.items[g],j.datum),j.items[g].group=j}}function f(b,c){if(b.duration&&(c.duration=b.duration),b.ease&&(c.ease=a.ease(b.ease)),b.delay){var d,e=c.items,f=c.group,g=e.length;for(d=0;g>d;++d)b.delay.call(this,e[d],f)}}function g(a){if(null==a)return null;var b=K.array(a).map(K.accessor);return function(a){for(var c="",d=0,e=b.length;e>d;++d)d>0&&(c+="|"),c+=String(b[d](a));return c}}var h=K.scene.GROUP,i=K.scene.ENTER,j=K.scene.UPDATE,k=K.scene.EXIT;return b}(),K.scene.bounds=function(){function b(){return w||(w=(K.config.isNode?new(require("canvas"))(1,1):a.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function c(a,b,c){return null==b?c.set(0,0,0,0):(q(b,c),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&c.expand(a.strokeWidth)),c}function d(a,b){var d=a.path?a["path:parsed"]||(a["path:parsed"]=p(a.path)):null;return c(a,d,b)}function e(a,b){var d=a.mark.items,a=d[0],e=a["path:parsed"]||(a["path:parsed"]=p(r(d)));return c(d[0],e,b)}function f(a,b){var d=a.mark.items,a=d[0],e=a["path:parsed"]||(a["path:parsed"]=p(s(d)));return c(d[0],e,b)}function g(a,b){var c=a.x||0,d=a.y||0,e=c+a.width||0,f=d+a.height||0;return b.set(c,d,e,f),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function h(a,b){var c=a.width||0,d=a.height||0,e=(a.x||0)-("center"===a.align?c/2:"right"===a.align?c:0),f=(a.y||0)-("middle"===a.baseline?d/2:"bottom"===a.baseline?d:0);return b.set(e,f,e+c,f+d)}function i(a,b){var c,d;return b.set(c=a.x||0,d=a.y||0,null!=a.x2?a.x2:c,null!=a.y2?a.y2:d),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function j(a,b){var c,d,e,f,g,h,i,j,k,l=a.x||0,m=a.y||0,n=a.innerRadius||0,o=a.outerRadius||0,p=(a.startAngle||0)-t,q=(a.endAngle||0)-t,r=1/0,s=-1/0,u=1/0,v=-1/0,w=[p,q],x=p-p%t;for(d=0;4>d&&q>x;++d,x+=t)w.push(x);for(d=0,e=w.length;e>d;++d)c=w[d],f=Math.cos(c),h=n*f,j=o*f,g=Math.sin(c),i=n*g,k=o*g,r=Math.min(r,h,j),s=Math.max(s,h,j),u=Math.min(u,i,k),v=Math.max(v,i,k);return b.set(l+r,m+u,l+s,m+v),a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function k(a,b){var c,d,e,f,g=null!=a.size?a.size:100,h=a.x||0,i=a.y||0;switch(a.shape){case"cross":c=Math.sqrt(g/5)/2,d=3*c,b.set(h-d,i-c,h+d,i+c);break;case"diamond":f=Math.sqrt(g/(2*v)),e=f*v,b.set(h-e,i-f,h+e,i+f);break;case"square":d=Math.sqrt(g),c=d/2,b.set(h-c,i-c,h+c,i+c);break;case"triangle-down":e=Math.sqrt(g/u),f=e*u/2,b.set(h-e,i-f,h+e,i+f);break;case"triangle-up":e=Math.sqrt(g/u),f=e*u/2,b.set(h-e,i-f,h+e,i+f);break;default:c=Math.sqrt(g/Math.PI),b.set(h-c,i-c,h+c,i+c)}return a.stroke&&0!==a.opacity&&a.strokeWidth>0&&b.expand(a.strokeWidth),b}function l(a,c,d){var e,f=(a.x||0)+(a.dx||0),g=(a.y||0)+(a.dy||0),h=a.fontSize||K.config.render.fontSize,i=a.align,j=a.baseline,k=b();return k.font=K.scene.fontString(a),k.textAlign=i||"left",k.textBaseline=j||"alphabetic",e=k.measureText(a.text||"").width,"center"===i?f-=e/2:"right"===i&&(f-=e),"top"===j?g+=h/5:"bottom"===j?g-=h:"middle"===j?g=g-h/2+h/10:g-=4*h/5,c.set(f,g,f+e,g+h),a.angle&&!d&&c.rotate(a.angle*Math.PI/180,a.x||0,a.y||0),c.expand(d?0:1)}function m(a,b,c){var d,e,f=a.axisItems||[],g=a.legendItems||[];for(d=0,e=f.length;e>d;++d)b.union(f[d].bounds);for(d=0,e=a.items.length;e>d;++d)b.union(a.items[d].bounds);if(c){for(d=0,e=g.length;e>d;++d)b.union(g[d].bounds);null!=a.width&&null!=a.height&&b.add(a.width,a.height),null!=a.x&&null!=a.y&&b.add(0,0)}return b.translate(a.x||0,a.y||0),b}function n(a,b,c){b=b||x[a.mark.marktype],a.bounds_prev||(a["bounds:prev"]=new K.Bounds);var d=a.bounds,e=a["bounds:prev"];return d&&e.clear().union(d),a.bounds=b(a,d?d.clear():new K.Bounds,c),d||e.clear().union(a.bounds),a.bounds}function o(a,b,c){b=b||a.bounds&&a.bounds.clear()||new K.Bounds;var d,e,f=a.marktype,g=x[f],h=a.items;if("area"===f||"line"===f)h[0].bounds=g(h[0],b);else for(d=0,e=h.length;e>d;++d)b.union(n(h[d],g,c));a.bounds=b}var p=K.canvas.path.parse,q=K.canvas.path.bounds,r=K.canvas.path.area,s=K.canvas.path.line,t=Math.PI/2,u=Math.sqrt(3),v=Math.tan(30*Math.PI/180),w=null,x={group:m,symbol:k,image:h,rect:g,rule:i,arc:j,text:l,path:d,area:e,line:f};return{mark:o,item:n,text:l,group:m}}(),K.scene.encode=function(){function a(a,d,e,f,g){return f&&g?b.call(this,a,d,e,f,g):c.call(this,a,a,d,e,f),a}function b(a,b,c,d,e){e=K.array(e);var f,g,h,i,j,k;for(f=0,g=e.length;g>f;++f)h=e[f],i=h.mark.group||null,j=h.mark.def.properties,k=j&&j[d],k&&(k.call(K,h,i,c),K.scene.bounds.item(h))}function c(a,b,c,d,h){f.call(this,a,b.items,c,d,h),b.marktype===g?e.call(this,b,c,a,d,h):K.scene.bounds.mark(b)}function d(a,b,c,d,g){e.call(this,b,c,a,d,g),f.call(this,a,b.items,c,d,g),K.scene.bounds.mark(b,null,!0)}function e(a,b,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;for(h=0,i=a.items.length;i>h;++h)for(l=a.items[h],m=l.scales||(l.scales=b.scales?K.extend({},e.scales):e.scales),b.scales&&K.parse.scales(b.scales,m,this._data,l),b.axes&&(n=l.axes||(l.axes=[]),o=l.axisItems||(l.axisItems=[]),K.parse.axes(b.axes,n,l.scales),n.forEach(function(a,b){p=a.def(),o[b]=K.scene.build(p,this._data,o[b]),o[b].group=l,c.call(this,l,l.axisItems[b],p,f)})),j=0,k=l.items.length;k>j;++j)c.call(this,l,l.items[j],b.marks[j],f,g);if(K.scene.bounds.mark(a,null,!b.legends),b.legends){for(h=0,i=a.items.length;i>h;++h)l=a.items[h],q=l.legends||(l.legends=[]),r=l.legendItems||(l.legendItems=[]),K.parse.legends(b.legends,q,l.scales),q.forEach(function(a,b){s=a.def(),r[b]=K.scene.build(s,this._data,r[b]),r[b].group=l,d.call(this,l,l.legendItems[b],s,f)});K.scene.bounds.mark(a,null,!0)}}function f(a,b,c,d,e){var f,g,l,m,n=c.properties||k,o=n.enter,p=n.update,q=n.exit;if(e){if(m=n[e])for(f=0,g=b.length;g>f;++f)m.call(K,b[f],a,d)}else for(f=0;f<b.length;++f)l=b[f],l.status===h&&(o&&o.call(K,l,a),l.status=i),l.status!==j&&p&&p.call(K,l,a,d),l.status===j&&(q&&q.call(K,l,a,d),d&&!q?d.interpolate(l,k):d||b[f--].remove())}var g=K.scene.GROUP,h=K.scene.ENTER,i=K.scene.UPDATE,j=K.scene.EXIT,k={};return a}(),K.scene.Transition=function(){function b(b,c){this.duration=b||500,this.ease=c&&a.ease(c)||a.ease("cubic-in-out"),this.updates={next:null}}function c(a){for(var b,c,d,e,f,g,h=this.updates,i=h,j=i.next,k=this.duration,l=!0;null!=j;i=j,j=i.next)if(b=j.item,c=b.delay||0,d=(a-c)/k,0>d)l=!1;else{for(d>1&&(d=1),e=j.ease(d),f=0,g=j.length;g>f;++f)b[j[f].property]=j[f](e);b.touch(),K.scene.bounds.item(b),1===d?(j.remove&&b.remove(),i.next=j.next,j=i):l=!1}return this.callback(),l}var d=b.prototype;return d.interpolate=function(b,c){var d,e,f,g,h=null;for(d in c)e=b[d],f=c[d],e!==f&&("text"===d?b[d]=f:(g=a.interpolate(e,f),g.property=d,(h||(h=[])).push(g)));return null===h&&b.status===K.scene.EXIT&&(h=[]),null!=h&&(h.item=b,h.ease=b.mark.ease||this.ease,h.next=this.updates.next,this.updates.next=h),this},d.start=function(b){for(var d=this,e=d.updates,f=e.next;null!=f;e=f,f=e.next)f.item.status===K.scene.EXIT&&(f.remove=!0);d.callback=b,a.timer(function(a){return c.call(d,a)})},b}(),K.scene.transition=function(a,b){return new K.scene.Transition(a,b)},K.scene.axis=function(){function a(){g=null}function b(a){var b,c,e;"ordinal"===a.type?(b={scale:a.scaleName,offset:.5+a.rangeBand()/2},c=b):(b={scale:a.scaleName,offset:.5},c={scale:a.scaleName+":prev",offset:.5}),e=q(a);var g=z(),h=z(),i=z(),j=A(),o=C(),p=B();g.properties.enter.stroke={value:K.config.axis.gridColor},s(d,g,c,b,1/0),s(d,h,c,b,k),s(d,i,c,b,l),r(d,j,c,b,k,n),v(d,o,e,m),u(d,p,e,f),K.extend(g.properties.update,D),K.extend(h.properties.update,F),K.extend(i.properties.update,G),K.extend(j.properties.update,E),K.extend(o.properties.update,I),K.extend(p.properties.update,H);var t=[g,h,i,j,o,p];return{type:"group",interactive:!1,properties:{enter:w,update:w},marks:t.map(K.parse.mark)}}var c,d=K.config.axis.orient,e=0,f=K.config.axis.titleOffset,g=null,h="front",i=!1,j=null,k=K.config.axis.tickSize,l=K.config.axis.tickSize,m=K.config.axis.tickSize,n=K.config.axis.padding,p=null,t=null,x=0,y=[K.config.axis.ticks],D={},E={},F={},G={},H={},I={},J={};return J.def=function(){var a=g?g:g=b(c),f=null==p?c.ticks?c.ticks.apply(c,y):c.domain():p,k=o(c,f,x).map(K.data.ingest);f=f.map(K.data.ingest);var l=null==t?c.tickFormat?c.tickFormat.apply(c,y):String:t;f.forEach(function(a){a.label=l(a.data)});var m=j?[j].map(K.data.ingest):[];return a.marks[0].from=function(){return i?f:[]},a.marks[1].from=function(){return f},a.marks[2].from=function(){return k},a.marks[3].from=a.marks[1].from,a.marks[4].from=function(){return[1]},a.marks[5].from=function(){return m},a.offset=e,a.orient=d,a.layer=h,a},J.scale=function(b){return arguments.length?(c!==b&&(c=b,a()),J):c},J.orient=function(b){return arguments.length?(d!==b&&(d=b in R?b+"":K.config.axis.orient,a()),J):d},J.title=function(b){return arguments.length?(j!==b&&(j=b,a()),J):j},J.ticks=function(){return arguments.length?(y=arguments,J):y},J.tickValues=function(a){return arguments.length?(p=a,J):p},J.tickFormat=function(a){return arguments.length?(t=a,J):t},J.tickSize=function(b,c){if(!arguments.length)return k;var d=arguments.length-1,e=+b,f=d>1?+c:k,g=d>0?+arguments[d]:k;return(k!==e||l!==f||m!==g)&&a(),k=e,l=f,m=g,J},J.tickSubdivide=function(a){return arguments.length?(x=+a,J):x},J.offset=function(a){return arguments.length?(e=K.isObject(a)?a:+a,J):e},J.tickPadding=function(b){return arguments.length?(n!==+b&&(n=+b,a()),J):n},J.titleOffset=function(b){return arguments.length?(f!==+b&&(f=+b,a()),J):f},J.layer=function(b){return arguments.length?(h!==b&&(h=b,a()),J):h},J.grid=function(b){return arguments.length?(i!==b&&(i=b,a()),J):i},J.gridLineProperties=function(a){return arguments.length?(D!==a&&(D=a),J):D},J.majorTickProperties=function(a){return arguments.length?(F!==a&&(F=a),J):F},J.minorTickProperties=function(a){return arguments.length?(G!==a&&(G=a),J):G},J.tickLabelProperties=function(a){return arguments.length?(E!==a&&(E=a),J):E},J.titleProperties=function(a){return arguments.length?(H!==a&&(H=a),J):H},J.domainProperties=function(a){return arguments.length?(I!==a&&(I=a),J):I},J.reset=function(){a()},J};var R={top:1,right:1,bottom:1,left:1},S={bottom:"center",top:"center",left:"right",right:"left"},T={bottom:"top",top:"bottom",left:"middle",right:"middle"};K.scene.legend=function(){function b(){h=null}function c(a){return"ordinal"===a||"quantize"===a||"quantile"===a||"threshold"===a}function d(b){var c,d,f,g=e(i,j,k,l),h=(null==n?b.ticks?b.ticks.apply(b,t):b.domain():n).map(K.data.ingest),q=null==o?b.tickFormat?b.tickFormat.apply(b,t):String:o,r=15,u=a.range(h.length);i?(d=h.map(function(a){return Math.sqrt(i(a.data))}),f=a.max(d),d=d.reduce(function(a,b,c,d){return c>0&&(a[c]=a[c-1]+d[c-1]/2+r),a[c]+=b/2,a},[0]).map(Math.round)):(f=Math.round(Math.sqrt(K.config.legend.symbolSize)),d=m||(c=y.fontSize)&&c.value+r||K.config.legend.labelFontSize+r,d=u.map(function(a,b){return Math.round(f/2+b*d)}));var v,w=s;p&&(v=x.fontSize,w+=5+(v&&v.value||K.config.legend.titleFontSize));for(var z=0,A=d.length;A>z;++z)d[z]+=w;var b={name:"legend",type:"ordinal",points:!0,domain:u,range:d},B=(p?[p]:[]).map(K.data.ingest);return h.forEach(function(a){a.label=q(a.data),a.offset=f}),g.scales=[b],g.marks[0].from=function(){return B},g.marks[1].from=function(){return h},g.marks[2].from=g.marks[1].from,g}function e(a,b,c,d){var e=F(),f=G(),g=H();return E(f,a,b,c,d),K.extend(e.properties.update,x),K.extend(f.properties.update,v),K.extend(g.properties.update,y),e.properties.enter.x.value+=s,e.properties.enter.y.value+=s,g.properties.enter.x.offset+=s+1,f.properties.enter.x.offset=s+1,g.properties.update.x.offset+=s+1,f.properties.update.x.offset=s+1,{type:"group",interactive:!1,properties:{enter:K.parse.properties("group",u),update:D},marks:[e,f,g].map(K.parse.mark)}}function f(a){var b=g(a),c=a.domain(),d=c.map(K.data.ingest),e=w.width&&w.width.value||K.config.legend.gradientWidth,f=null==o?a.tickFormat?a.tickFormat.apply(a,t):String:o,h={name:"legend",type:a.type,round:!0,zero:!1,domain:[c[0],c[c.length-1]],range:[s,e+s]};"pow"===a.type&&(h.exponent=a.exponent());var i=(p?[p]:[]).map(K.data.ingest);return d.forEach(function(a,b){a.label=f(a.data),a.align=b==d.length-1?"right":0==b?"left":"center"}),b.scales=[h],b.marks[0].from=function(){return i},b.marks[1].from=function(){return[1]},b.marks[2].from=function(){return d},b}function g(a){var b=F(),c=I(),d=J(),e=new K.Gradient,f=a.domain(),g=f[0],h=f[f.length-1],i=a.copy().domain([g,h]).range([0,1]),j="linear"!==a.type&&a.ticks?a.ticks.call(a,15):f;g!==j[0]&&j.unshift(g),h!==j[j.length-1]&&j.push(h);for(var k=0,l=j.length;l>k;++k)e.stop(i(j[k]),a(j[k]));c.properties.enter.fill={value:e},K.extend(b.properties.update,x),K.extend(c.properties.update,w),K.extend(d.properties.update,y);var m=c.properties,n=w.height,o=n&&n.value||m.enter.height.value;if(d.properties.enter.y.value=o,d.properties.update.y.value=o,p){var q=b.properties,r=x.fontSize,t=4+(r&&r.value||q.enter.fontSize.value);c.properties.enter.y.value+=t,d.properties.enter.y.value+=t,c.properties.update.y.value+=t,d.properties.update.y.value+=t}return b.properties.enter.x.value+=s,b.properties.enter.y.value+=s,c.properties.enter.x.value+=s,c.properties.enter.y.value+=s,d.properties.enter.y.value+=s,c.properties.update.x.value+=s,c.properties.update.y.value+=s,d.properties.update.y.value+=s,{type:"group",interactive:!1,properties:{enter:K.parse.properties("group",u),update:D},marks:[b,c,d].map(K.parse.mark)}}var h,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=void 0,q="right",r=K.config.legend.offset,s=K.config.legend.padding,t=[5],u={},v={},w={},x={},y={},z={},h=null;return z.def=function(){var a=i||j||k||l;return h||(h=a!==k&&a!==l||c(a.type)?d(a):f(a)),h.orient=q,h.offset=r,h.padding=s,h},z.size=function(a){return arguments.length?(i!==a&&(i=a,b()),z):i},z.shape=function(a){return arguments.length?(j!==a&&(j=a,b()),z):j},z.fill=function(a){return arguments.length?(k!==a&&(k=a,b()),z):k},z.stroke=function(a){return arguments.length?(l!==a&&(l=a,b()),z):l},z.title=function(a){return arguments.length?(p!==a&&(p=a,b()),z):p},z.format=function(a){return arguments.length?(o!==a&&(o=a,b()),z):o},z.spacing=function(a){return arguments.length?(m!==+a&&(m=+a,b()),z):m},z.orient=function(a){return arguments.length?(q=a in U?a+"":K.config.legend.orient,z):q},z.offset=function(a){return arguments.length?(r=+a,z):r},z.values=function(a){return arguments.length?(n=a,z):n},z.legendProperties=function(a){return arguments.length?(u=a,z):u},z.symbolProperties=function(a){return arguments.length?(v=a,z):v},z.gradientProperties=function(a){return arguments.length?(w=a,z):w},z.labelProperties=function(a){return arguments.length?(y=a,z):y},z.titleProperties=function(a){return arguments.length?(x=a,z):x},z.reset=function(){b()},z};var U={right:1,left:1};return K.Model=function(){function a(){this._defs=null,this._data={},this._scene=null,this._reset={axes:!1,legends:!1}}var b=a.prototype;return b.defs=function(a){return arguments.length?(this._defs=a,this):this._defs},b.data=function(a){if(!arguments.length)return this._data;var b,c,d=this._defs.data.flow||{},e=this._defs.data.defs.map(K.accessor("name")),f=e.length;for(b=0;f>b;++b)a[c=e[b]]&&this.ingest(c,d,a[c]);return this._reset.legends=!0,this},b.ingest=function(a,b,c){this._data[a]=b[a]?b[a](c,this._data,this._defs.marks):c,this.dependencies(a,b)},b.dependencies=function(a,b){var c,d,e=this._defs.data.source[a],g=this._data[a],i=e?e.length:0;for(c=0;i>c;++c)d=h(g),K.isTree(g)&&f(d),this.ingest(e[c],b,d)},b.width=function(a){return this._defs&&(this._defs.width=a),this._defs&&this._defs.marks&&(this._defs.marks.width=a),this._scene&&(this._scene.items[0].width=a),this._reset.axes=!0,this},b.height=function(a){return this._defs&&(this._defs.height=a),this._defs&&this._defs.marks&&(this._defs.marks.height=a),this._scene&&(this._scene.items[0].height=a),this._reset.axes=!0,this},b.scene=function(a){return arguments.length?(this._scene=a,this):this._scene},b.build=function(){var a=this,b=a._data,c=a._defs.marks;return a._scene=K.scene.build.call(a,c,b,a._scene),a._scene.items[0].width=c.width,a._scene.items[0].height=c.height,a._scene.interactive=!1,this},b.encode=function(a,b,c){this.reset();var d=this,e=d._scene,f=d._defs;return K.scene.encode.call(d,e,f.marks,a,b,c),this},b.reset=function(){return this._scene&&this._reset.axes&&(K.scene.visit(this._scene,function(a){a.axes&&a.axes.forEach(function(a){a.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(K.scene.visit(this._scene,function(a){a.legends&&a.legends.forEach(function(a){a.reset()})}),this._reset.legends=!1),this},a}(),K.View=function(){var b=function(a,b,c){this._el=null,this._build=!1,this._model=new K.Model,this._width=this.__width=b||500,this._height=this.__height=c||500,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=K.canvas,a&&this.initialize(a)},c=b.prototype;return c.width=function(a){return arguments.length?(this.__width!==a&&(this._width=this.__width=a,this._el&&this.initialize(this._el.parentNode),this._model.width(a),this._strict&&(this._autopad=1)),this):this.__width},c.height=function(a){return arguments.length?(this.__height!==a&&(this._height=this.__height=a,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height),this._strict&&(this._autopad=1)),this):this.__height},c.padding=function(a){return arguments.length?(this._padding!==a&&(K.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,a),this._handler.padding(a))),this):this._padding},c.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this.model().scene().bounds,d=K.config.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},c.viewport=function(a){return arguments.length?(this._viewport!==a&&(this._viewport=a,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},c.renderer=function(a){return arguments.length?("canvas"===a&&(a=K.canvas),"svg"===a&&(a=K.svg),this._io!==a&&(this._io=a,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},c.defs=function(a){return arguments.length?(this._model.defs(a),this):this._model.defs()},c.data=function(a){if(!arguments.length)return this._model.data();var b=K.keys(a).reduce(function(b,c){return b[c]=K.data.ingestAll(a[c]),b},{});return this._model.data(b),this._build=!1,this},c.model=function(a){return arguments.length?(this._model!==a&&(this._model=a,this._handler&&this._handler.model(a)),this):this._model},c.initialize=function(b){var c,d=this,e=d._width,f=d._height,g=d._padding;return a.select(b).select("div.vega").remove(),this._el=b=a.select(b).append("div").attr("class","vega").style("position","relative").node(),d._viewport&&a.select(b).style("width",(d._viewport[0]||e)+"px").style("height",(d._viewport[1]||f)+"px").style("overflow","auto"),d._renderer=(d._renderer||new this._io.Renderer).initialize(b,e,f,g),c=d._handler,d._handler=(new this._io.Handler).initialize(b,g,d).model(d._model),c&&c.handlers().forEach(function(a){d._handler.on(a.type,a.handler)}),this},c.render=function(a){return this._renderer.render(this._model.scene(),a),this},c.on=function(){return this._handler.on.apply(this._handler,arguments),this},c.off=function(){return this._handler.off.apply(this._handler,arguments),this},c.update=function(a){a=a||{};var b=this,c=a.duration?K.scene.transition(a.duration,a.ease):null;return b._build=b._build||(b._model.build(),!0),b._model.encode(c,a.props,a.items),c?c.start(function(a){b._renderer.render(b._model.scene(),a)}):b.render(a.items),b.autopad(a)},b}(),K.ViewFactory=function(a){return function(b){b=b||{};var c=(new K.View).width(a.width).height(a.height).padding(a.padding).viewport(a.viewport).renderer(b.renderer||"canvas").defs(a);return a.data.load&&c.data(a.data.load),b.data&&c.data(b.data),b.el&&c.initialize(b.el),b.hover!==!1&&c.on("mouseover",function(a,b){b.hasPropertySet("hover")&&this.update({props:"hover",items:b})}).on("mouseout",function(a,b){b.hasPropertySet("hover")&&this.update({props:"update",items:b})}),c}},K.Spec=function(){var a=function(a){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},a&&K.extend(this.spec,a)},b=a.prototype;return b.width=function(a){return this.spec.width=a,this},b.height=function(a){return this.spec.height=a,this},b.padding=function(a){return this.spec.padding=a,this},b.viewport=function(a){return this.spec.viewport=a,this},b.data=function(a,b){return b?b.name=a:b=K.isString(a)?{name:a}:a,this.spec.data.push(b),this},b.scale=function(a,b){return b?b.name=a:b=K.isString(a)?{name:a}:a,this.spec.scales.push(b),this},b.axis=function(a){return this.spec.axes.push(a),this},b.mark=function(a,b){b?b.type=a:b={type:a},b.properties={},this.spec.marks.push(b);var c=this;return{from:function(a,c){return b.from=c?(c.data=a,c):K.isString(a)?{data:a}:a,this},prop:function(a,c){return b.properties[a]=K.keys(c).reduce(function(a,b){var d=c[b];return a[b]=K.isObject(d)?d:{value:d},a},{}),this},done:function(){return c}}},b.parse=function(a){K.parse.spec(this.spec,a)},b.json=function(){return this.spec},a}(),K.spec=function(a){return new K.Spec(a)},K.headless={},K.headless.View=function(){var b=function(a,b,c,d){this._canvas=null,this._type=d,this._el="body",this._build=!1,this._model=new K.Model,this._width=this.__width=a||500,this._height=this.__height=b||500,this._autopad=1,this._padding=c||{top:0,left:0,bottom:0,right:0},this._renderer=new K[d].Renderer,this.initialize()},c=b.prototype;return c.el=function(a){return arguments.length?(this._el!==a&&(this._el=a,this.initialize()),this):this._el},c.width=function(a){return arguments.length?(this._width!==a&&(this._width=a,this.initialize(),this._model.width(a)),this):this._width},c.height=function(a){return arguments.length?(this._height!==a&&(this._height=a,this.initialize(),this._model.height(this._height)),this):this._height},c.padding=function(a){return arguments.length?(this._padding!==a&&(K.isString(a)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===a):(this._autopad=0,this._padding=a,this._strict=!1),this.initialize()),this):this._padding},c.autopad=function(a){if(this._autopad<1)return this;this._autopad=0;var b=this._padding,c=this._model.scene().bounds,d=K.config.autopadInset,e=c.x1<0?Math.ceil(-c.x1)+d:0,f=c.y1<0?Math.ceil(-c.y1)+d:0,g=c.x2>this._width?Math.ceil(+c.x2-this._width)+d:0,c=c.y2>this._height?Math.ceil(+c.y2-this._height)+d:0;return b={left:e,top:f,right:g,bottom:c},this._strict?(this._autopad=0,this._padding=b,this._width=Math.max(0,this.__width-(e+g)),this._height=Math.max(0,this.__height-(f+c)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(),this.update({props:"enter"}).update({props:"update"})):this.padding(b).update(a),this},c.viewport=function(){return arguments.length?this:null},c.defs=function(a){return arguments.length?(this._model.defs(a),this):this._model.defs()},c.data=function(a){if(!arguments.length)return this._model.data();var b=K.keys(a).reduce(function(b,c){return b[c]=K.data.ingestAll(a[c]),b},{});return this._model.data(b),this._build=!1,this},c.renderer=function(){return this._renderer},c.canvas=function(){return this._canvas},c.canvasAsync=function(a){function b(){0===c.pendingImages()?(d.render(),a(d._canvas)):setTimeout(b,10)}var c=this._renderer,d=this;c.pendingImages()>0?b():a(this._canvas)},c.svg=function(){if("svg"!==this._type)return null;var b=this._padding,c=this._width+(b?b.left+b.right:0),d=this._height+(b?b.top+b.bottom:0),e=a.select(this._el).select("svg").node().innerHTML.replace(/ href=/g," xlink:href=");return'<svg width="'+c+'" height="'+d+'" '+K.config.svgNamespace+">"+e+"</svg>"},c.initialize=function(){var a=this._width,b=this._height,c=this._padding;return"svg"===this._type?this.initSVG(a,b,c):this.initCanvas(a,b,c),this},c.initCanvas=function(a,b,c){var d=require("canvas"),e=a+c.left+c.right,f=b+c.top+c.bottom,g=this._canvas=new d(e,f),h=g.getContext("2d");h.setTransform(1,0,0,1,c.left,c.top),this._renderer.context(h),this._renderer.resize(a,b,c)},c.initSVG=function(a,b,c){a+c.left+c.right,b+c.top+c.bottom;this._renderer.initialize(this._el,a,b,c)},c.render=function(a){return this._renderer.render(this._model.scene(),a),this},c.update=function(a){a=a||{};var b=this;return b._build=b._build||(b._model.build(),!0),b._model.encode(null,a.props,a.items),b.render(a.items),b.autopad(a)},b}(),K.headless.View.Factory=function(a){return function(b){b=b||{};var c=a.width,d=a.height,e=a.padding,f=b.renderer||"canvas",g=new K.headless.View(c,d,e,f).defs(a);return a.data.load&&g.data(a.data.load),b.data&&g.data(b.data),g}},K.headless.render=function(a,b){function c(c){try{var d=c({data:a.data,renderer:a.renderer}).update();"svg"===a.renderer?b(null,{svg:d.svg()}):d.canvasAsync(function(a){b(null,{canvas:a})})}catch(e){b(e,null)}}K.parse.spec(a.spec,c,K.headless.View.Factory)},K}(d3,"undefined"==typeof topojson?null:topojson);